BPDU是运行STP的交换机之间交换的消息帧。BPDU内包含了STP所需的路径和优先级信息，STP便利用这些信息来确定根桥以及到根桥的路径。
中文名网桥协议数据单元
外文名 Bridge Protocol Data Unit
报文类型 BPDU类型
版本号 STP的版本(为IEEE 802.1d时值为0
协议ID 该值总为0。

概念介绍
网桥协议数据单元（Bridge Protocol Data Unit)。是一种生成树协议问候数据包，它可以配置的间隔发出，用来在网络的网桥间进行信息交换。
当一个网桥开始变为活动时，它的每个端口都是每2s（使用缺省定时值时）发送一个BPDU。然而，如果一个端口收到另外一个网桥发送过来的BPDU，而这个BPDU比它正在发送的BPDU更优，则本地端口会停止发送BPDU。如果在一段时间（缺省为20s）后它不再接收到邻居的更优的BPDU，则本地端口会再次发送BPDU。
BPDU是网桥协议数据单元（Bridge Protocol Data Unit）的英文首字母缩写。


主要字段
协议ID：该值总为0。
版本号：STP的版本(为IEEE 802.1d时值为0)。
报文类型：BPDU类型(配置BPDU=0，TCN BPDU=80)。
标记域：LSB(最低有效位)=TCN标志；MSB(最高有效位)=TCA标志。
根网桥ID：根信息由2字节优先级和6字节ID组成。这个信息组合标明已经被选定为根网桥的设备标识。
根路径成本：路径成本为到达根网桥交换机的STP开销。表明这个BPDU从根网桥传输了多远，成本是多少。这个字段的值用来决定哪些端口将进行转发，哪些端口将被阻断。
发送网络桥ID：发送该BPDU的网桥信息。由网桥的优先级和网桥ID组成。
端口ID：发送该BPDU的网桥端口ID。
计时器：计时器用于说明生成树用多长时间完成它的每项功能。这些功能包括报文老化时间、最大老化时间、访问时间和转发延迟。
最大老化时间：网桥将将根桥看做不可用前保留根ID的最大时间。
访问时间：根网桥连续发送BPDU的时间间隔。
转发延迟：网桥在监听学习状态所停留的时间。

网桥方式
BPDU究竟是如何工作的呢？
这得从网桥说起。网桥有三种典型的方式：透明桥、源路由桥与源路由透明桥。
网桥典型地连接两个用同样介质存取控制方法的网段，IEEE 802.1d规范（此规范是为所有的802介质存取方法开发的）定义了透明桥。源路由桥是由IBM公司为它的令牌环网络开发的；而源路由透明桥则是透明桥和源路由桥的组合。桥两边的网段分属于不同的冲突域，但却属于同一个广播域。

路径连接原理编辑
在一个桥接的局域网里，为了增强可靠性，必然要建立一个冗余的路径，网段会用冗余的网桥连接。但是，在一个透明桥桥接的网络里，存在冗余的路径就能建立一个桥回路，桥回路对于一个局域网是致命的。
生成树协议是一种桥嵌套协议，在IEEE 802.1d规范里定义，可以用来消除桥回路。它的工作原理是这样的：生成树协议定义了一个数据包，叫做桥协议数据单元BPDU（Bridge Protocol Data Unit）。网桥用BPDU来相互通信，并用BPDU的相关机能来动态选择根桥和备份桥。但是因为从中心桥到任何网段只有一个路径存在，所以桥回路被消除。
在一个生成树环境里，桥不会立即开始转发功能，它们必须首先选择一个桥为根桥，然后建立一个指定路径。在一个网络里边拥有最低桥ID的将变成一个根桥，全部的生成树网络里面只有一个根桥。根桥的主要职责是定期发送配置信息，然后这种配置信息将会被所有的指定桥发送。这在生成树网络里面是一种机制，一旦网络结构发生变化，网络状态将会重新配置。
当选定根桥之后，在转发数据包之前，它们必须决定每一个网段的指定桥，运用生成树的这种算法，根桥每隔2秒钟从它所有的端口发送BPDU包，BPDU包被所有的桥从它们的根端口复制过来，根端口是接根桥的那些桥端口。BPDU包括的信息叫做端口的COST，网络管理员分配端口的COST到所有的桥端口，当根桥发送BPDU的时候，根桥设置它的端口值为零。然后沿着这条路径，下一个桥增加它的配置端口COST为一个值，这个值是它接收和转发数据包到下一个网段的值。这样每一个桥都增加它的端口的COST值为它所接收的BPDU的包的COST值，所有的桥都检测它们的端口的COST值，拥有最低端口的COST值的桥就变为了指定的桥。拥有比较高端口COST值的桥置它的端口进入阻塞状态，变为了备份桥。在阻塞状态，一个桥停止了转发，但是它会继续接收和处理BPDU数据包。





STP--生成树协议（简单理解） 
为什么要有生成树协议（ spanning-tree protocol）？

   在传统的交换网络中会产生故障（单点故障），导致主机通信失败。


单点故障如何解决？

   1.增加冗余链路

   2.增加冗余设备

   
   
     增加冗余链路的情况下，会产生什么问题？

     在增加冗余链路的情况下，产生环路的数据（即广播风暴），会不断的在网络中进行传输，从而消耗网络中链路资源和设备资源。
   
   
   
   如何解决这个问题？

     STP（spanning-tree protocol）---生成协议

    作用----存在冗余链路的情况下，实现环路保护，（即线路故障时，阻塞端口打开，恢复数据通信）

    实现----BPDU（网桥协议数据单元）

    分类----PVST/RSTP/MSTP



   工作过程

  1.确定交换机的角色

     分类：

           根交换机（只有一个）

           非根交换机（除根交换机以外的交换机）

     原则：

           比较每个交换机的BID（桥ID），越小越好

           组成：优先级+MAC地址（基MAC）

                 优先级：默认是32768

                  MAC地址：交换机主板MAC地址

                   sw#show version

  2.确定端口角色

     分类：

          根端口---在非根交换机上距离根交换机最近的端口

        指定端口---每一个冲突域中，距离根交换机最近的端口

               （冲突域---交换机端口互联形成）---根交换机上的端口均为指定端口

      非指定端口---除根端口及指定端口以外的交换机端口

   判断思路----首先判断根端口----->再判断指定端口------>最后判断非指定端口
   
   
   
   如何表示上文中“最近“这个距离？

            在STP中，通过cost 表示一个路径的距离

         对于某些链路，均有默认的cost值：

          10 M --- cost 100

          100M --- cost 19

          1000M（1G） ---- cost 4

          10000M（10G） ---- cost 2

    通过什么来判断端口所属角色？

       BPDU--桥协议数据单元

        root-id      //表示根交换机是谁

        cost        //表示发送该BPDU协议的交换机到达根交换的距离

        BID         //表示发送该BPDU的交换机的名字

        Port-id      //表示发送方交换机是在那个端口发送出来的

                    （组成--优先级（默认128）+MAC地址） 

                  以上都是越小越好!!!
   
   
   
   
   
   
   
   
   
   
   
   
   
   




