BPDU是运行STP的交换机之间交换的消息帧。BPDU内包含了STP所需的路径和优先级信息，STP便利用这些信息来确定根桥以及到根桥的路径。
中文名网桥协议数据单元
外文名 Bridge Protocol Data Unit
报文类型 BPDU类型
版本号 STP的版本(为IEEE 802.1d时值为0
协议ID 该值总为0。

概念介绍
网桥协议数据单元（Bridge Protocol Data Unit)。是一种生成树协议问候数据包，它可以配置的间隔发出，用来在网络的网桥间进行信息交换。
当一个网桥开始变为活动时，它的每个端口都是每2s（使用缺省定时值时）发送一个BPDU。然而，如果一个端口收到另外一个网桥发送过来的BPDU，而这个BPDU比它正在发送的BPDU更优，则本地端口会停止发送BPDU。如果在一段时间（缺省为20s）后它不再接收到邻居的更优的BPDU，则本地端口会再次发送BPDU。
BPDU是网桥协议数据单元（Bridge Protocol Data Unit）的英文首字母缩写。


主要字段
协议ID：该值总为0。
版本号：STP的版本(为IEEE 802.1d时值为0)。
报文类型：BPDU类型(配置BPDU=0，TCN BPDU=80)。
标记域：LSB(最低有效位)=TCN标志；MSB(最高有效位)=TCA标志。
根网桥ID：根信息由2字节优先级和6字节ID组成。这个信息组合标明已经被选定为根网桥的设备标识。
根路径成本：路径成本为到达根网桥交换机的STP开销。表明这个BPDU从根网桥传输了多远，成本是多少。这个字段的值用来决定哪些端口将进行转发，哪些端口将被阻断。
发送网络桥ID：发送该BPDU的网桥信息。由网桥的优先级和网桥ID组成。
端口ID：发送该BPDU的网桥端口ID。
计时器：计时器用于说明生成树用多长时间完成它的每项功能。这些功能包括报文老化时间、最大老化时间、访问时间和转发延迟。
最大老化时间：网桥将将根桥看做不可用前保留根ID的最大时间。
访问时间：根网桥连续发送BPDU的时间间隔。
转发延迟：网桥在监听学习状态所停留的时间。

网桥方式
BPDU究竟是如何工作的呢？
这得从网桥说起。网桥有三种典型的方式：透明桥、源路由桥与源路由透明桥。
网桥典型地连接两个用同样介质存取控制方法的网段，IEEE 802.1d规范（此规范是为所有的802介质存取方法开发的）定义了透明桥。源路由桥是由IBM公司为它的令牌环网络开发的；而源路由透明桥则是透明桥和源路由桥的组合。桥两边的网段分属于不同的冲突域，但却属于同一个广播域。

路径连接原理编辑
在一个桥接的局域网里，为了增强可靠性，必然要建立一个冗余的路径，网段会用冗余的网桥连接。但是，在一个透明桥桥接的网络里，存在冗余的路径就能建立一个桥回路，桥回路对于一个局域网是致命的。
生成树协议是一种桥嵌套协议，在IEEE 802.1d规范里定义，可以用来消除桥回路。它的工作原理是这样的：生成树协议定义了一个数据包，叫做桥协议数据单元BPDU（Bridge Protocol Data Unit）。网桥用BPDU来相互通信，并用BPDU的相关机能来动态选择根桥和备份桥。但是因为从中心桥到任何网段只有一个路径存在，所以桥回路被消除。
在一个生成树环境里，桥不会立即开始转发功能，它们必须首先选择一个桥为根桥，然后建立一个指定路径。在一个网络里边拥有最低桥ID的将变成一个根桥，全部的生成树网络里面只有一个根桥。根桥的主要职责是定期发送配置信息，然后这种配置信息将会被所有的指定桥发送。这在生成树网络里面是一种机制，一旦网络结构发生变化，网络状态将会重新配置。
当选定根桥之后，在转发数据包之前，它们必须决定每一个网段的指定桥，运用生成树的这种算法，根桥每隔2秒钟从它所有的端口发送BPDU包，BPDU包被所有的桥从它们的根端口复制过来，根端口是接根桥的那些桥端口。BPDU包括的信息叫做端口的COST，网络管理员分配端口的COST到所有的桥端口，当根桥发送BPDU的时候，根桥设置它的端口值为零。然后沿着这条路径，下一个桥增加它的配置端口COST为一个值，这个值是它接收和转发数据包到下一个网段的值。这样每一个桥都增加它的端口的COST值为它所接收的BPDU的包的COST值，所有的桥都检测它们的端口的COST值，拥有最低端口的COST值的桥就变为了指定的桥。拥有比较高端口COST值的桥置它的端口进入阻塞状态，变为了备份桥。在阻塞状态，一个桥停止了转发，但是它会继续接收和处理BPDU数据包。





STP--生成树协议（简单理解） 
为什么要有生成树协议（ spanning-tree protocol）？

   在传统的交换网络中会产生故障（单点故障），导致主机通信失败。


单点故障如何解决？

   1.增加冗余链路

   2.增加冗余设备

   
   
     增加冗余链路的情况下，会产生什么问题？

     在增加冗余链路的情况下，产生环路的数据（即广播风暴），会不断的在网络中进行传输，从而消耗网络中链路资源和设备资源。
   
   
   
   如何解决这个问题？

     STP（spanning-tree protocol）---生成协议

    作用----存在冗余链路的情况下，实现环路保护，（即线路故障时，阻塞端口打开，恢复数据通信）

    实现----BPDU（网桥协议数据单元）

    分类----PVST/RSTP/MSTP



   工作过程

  1.确定交换机的角色

     分类：

           根交换机（只有一个）

           非根交换机（除根交换机以外的交换机）

     原则：

           比较每个交换机的BID（桥ID），越小越好

           组成：优先级+MAC地址（基MAC）

                 优先级：默认是32768

                  MAC地址：交换机主板MAC地址

                   sw#show version

  2.确定端口角色

     分类：

          根端口---在非根交换机上距离根交换机最近的端口

        指定端口---每一个冲突域中，距离根交换机最近的端口

               （冲突域---交换机端口互联形成）---根交换机上的端口均为指定端口

      非指定端口---除根端口及指定端口以外的交换机端口

   判断思路----首先判断根端口----->再判断指定端口------>最后判断非指定端口
   
   
   
   如何表示上文中“最近“这个距离？

            在STP中，通过cost 表示一个路径的距离

         对于某些链路，均有默认的cost值：

          10 M --- cost 100

          100M --- cost 19

          1000M（1G） ---- cost 4

          10000M（10G） ---- cost 2

    通过什么来判断端口所属角色？

       BPDU--桥协议数据单元

        root-id      //表示根交换机是谁

        cost        //表示发送该BPDU协议的交换机到达根交换的距离

        BID         //表示发送该BPDU的交换机的名字

        Port-id      //表示发送方交换机是在那个端口发送出来的

                    （组成--优先级（默认128）+MAC地址） 

                  以上都是越小越好!!!
   
   
   
   生成树中的5种交换机端口状态，3种端口角色，和3种生成树协议模式
端口状态：
①关闭（disable）：端口处于管理关闭状态
 即DIS
②阻塞（blocking）: 不能转发用户数据
 即BLK
③监听（listening）: 接口开始启动
 即LIS
④学习（learning) : 学习MAC地址, 构建MAC表进程项
 即LRN
⑤转发（forwarding）: 可以转发用户数据
 即FWD

端口角色：
ROOT：交换机的根端口
Desg：指定端口
Altn：非指定端口

生成树模式：
1.802.1D，思科设备上默认开启的传统生成树（效果较差），PVST+
2.802.1w，快速生成树，Rapid PVST+（RSTP）
3.802.1s，多实例生成树，华为设备默认开启，MSTP
在交换机全剧模式下使用命令spanning-tree mode XXX更改生成树的模式
   
   
   
   生成树协议（英语：Spanning Tree Protocol，STP），是一种工作在OSI网络模型中的第二层(数据链路层)的通信协议，基本应用是防止交换机冗余链路产生的环路.用于确保以太网中无环路的逻辑拓扑结构.从而避免了广播风暴,大量占用交换机的资源。
   
   工作原理
生成树协议工作原理:任意一交换机中如果到达根网桥有两条或者两条以上的链路.生成树协议都根据算法把其中一条切断,仅保留一条.从而保证任意两个交换机之间只有一条单一的活动链路.因为这种生成的这种拓扑结构.很像是以根交换机为树干的树形结构.故为生成树协议。
   
   
   
  简介
生成树协议（英语：Spanning Tree Protocol，STP），是一种工作在OSI网络模型中的第二层(数据链路层)的通信协议，基本应用是防止交换机冗余链路产生的环路.用于确保以太网中无环路的逻辑拓扑结构.从而避免了广播风暴,大量占用交换机的资源.
生成树协议是基于Radia Perlman在DEC工作时发明的一种算法被纳入了IEEE 802.1d中， [1]  2001年IEEE组织推出了快速生成树协议(RSTP)在网络结构发生变化时其比STP更快的收敛网络,还引进了端口角色来完善了收敛机制,被纳入在IEEE 802.1w中。



工作过程
STP的工作过程如下：首先进行根网桥的选举，其依据是网桥优先级（bridge priority）和MAC地址组合生成的桥ID，桥ID最小的网桥将成为网络中的根桥（bridge root）。在此基础上，计算每个节点到根桥的距离，并由这些路径得到各冗余链路的代价，选择最小的成为通信路径（相应的端口状态变为forwarding），其它的就成为备份路径(相应的端口状态变为blocking)。STP生成过程中的通信任务由BPDU完成，这种数据包又分为包含配置信息的配置BPDU（其大小不超过35B）和包含拓扑变化信息的通知BPDU（其长度不超过4B）。



STP端口状态
端口状态	端口能力
Disabled	不收发任何报文
Blocking	不接收或者转发数据，接收但不发送BPDU，不进行地址学习
Listening	不接收或者转发数据，接收并发送BPDU，不进行地址学习
Learning	不接收或者转发数据，接收并发送BPDU，开始进行地址学习
Forwarding	接收或者转发数据，接收并发送BPDU，进行地址学习

功能
生成树协议的主要功能有两个：一是在利用生成树算法、在以太网络中，创建一个以某台交换机的某个端口为根的生成树，避免环路。二是在以太网络拓扑发生变化时，通过生成树协议达到收敛保护的目的。


特点
（1）生成树协议提供一种控制环路的方法。采用这种方法，在连接发生问题的时候，你控制的以太网能够绕过出现故障的连接。
（2）生成树中的根桥是一个逻辑的中心，并且监视整个网络的通信。最好不要依靠设备的自动选择去挑选哪一个网桥会成为根桥。
（3）生成树协议重新计算是繁冗的。恰当地设置主机连接端口(这样就不会引起重新计算)，推荐使用快速生成树协议。
（4）生成树协议可以有效的抑制广播风暴。开启生成树协议后抑制广播风暴，网络将会更加稳定，可靠性、安全性会大大增强。


 
 
 
  为什么要对计算机网络分层以及分层的一般原则 
 
  分层的理由
·将网络的通信过程划分为小一些、简单一些的部件,因此有助于各个部件的开发、设计和故障排除。
·通过网络组件的标准化,允许多个供应商进行开发。
·通过定义在模型的每一层实现什么功能,鼓励产业的标准化。
·允许各种类型的网络硬件和软件相互通信。
·防止对某一层所做的改动影响到其他的层,这样就有利于开发。
分层的原则
1.各个层之间有清晰的边界,便于理解;
2.每个层实现特定的功能;
3.层次的划分有利于国际标准协议的制定;
4.层的数目应该足够多，以避免各个层功能重复
 
 
 
 
 ISP
互联网服务提供商 ISP 可以从互联网管理机构获得许多 IP 地址，同时拥有通信线路以及路由器等联网设备，个人或机构向 ISP 缴纳一定的费用就可以接入互联网。

目前的互联网是一种多层次 ISP 结构，ISP 根据覆盖面积的大小分为主干 ISP、地区 ISP 和本地 ISP。

互联网交换点 IXP 允许两个 ISP 直接相连而不用经过第三个 ISP。
 
 
 ISP （互联网服务提供商）
 
 ISP(Internet Service Provider)，互联网服务提供商，即向广大用户综合提供互联网接入业务、信息业务和增值业务的电信运营商。ISP是经国家主管部门批准的正式运营企业，享受国家法律保护
 
 
 ISP：全称为Internet Service Provider，即因特网服务提供商，能提供拨号上网服务、网上浏览、下载文件、
收发电子邮件等服务，是网络最终用户进入Internet的入口和桥梁。它包括Internet接入服务和Internet内容提供服务。这里主要是Internet接入服务，即通过电话线把你的计算机或其他终端设备连入Internet
 由于接驳国际互联网需要租用国际信道，其成本对于一般用户是无法承担的。Internet接入提供商作为提供接驳服务的中介，需投入大量资金建立中转站，租用国际信道和大量的当地电话线，购置一系列计算机设备，通过集中使用，分散压力的方式，向本地用户提供接驳服务。较大的ISPs拥有他们自己的高速租用线路以至于他们很少依赖电信供应商，并且能够为他们的客户提供更好的服务。最大的国际和地域性因特网服务提供商有：AT&T WorldNet，IBM全球网，MCI，Netcom，UUNet，和PSINet
 
 在ISP证书上指的是“第二类增值电信业务中的因特网接入服务业务”，可以这么理解，这个“接入服务”，指的是“为接入互联网而进行的一系列配套服务”，这个接入概念并不仅仅指连接一个宽带光纤等物理接入，也指把一个网站等信息载体成功和互联网连接，为接入互联网而进行的一系列配套增值服务，如空间出租，服务器托管等。因此信息产业部的表达比仅仅用“技术服务商”解释ISP要完整
 
划分类别
目前按照主营的业务划分，中国ISP主要有以下几类：

1.搜索引擎ISP
如百度，Google等。 [3] 
2.即时通信ISP
即时通信ISP主要提供基于互联网和基于移动互联网的即时通信业务。由于即时通信的ISP自己掌握用户资源，因此在即时通信的业务价值链中，即时通信ISP能起到主导作用，这在同运营商合作的商业模式中非常少见。现在运营商也在发力即时通信，如移动的飞信、电信的易信。

3.移动互联网业务ISP
移动互联网业务ICP主要提供移动互联网服务，包括：WAP上网服务、移动即时通信服务、信息下载服务等。 [3] 
4.门户ISP提供新闻信息、文化信息等信息服务。
门户ISP以向公众提供各种信息为主业，具有稳定的用户群。门户ISP的收入来源比较广，包括在线广告、移动业务、网络游戏及其他业务。比如：新浪、搜狐、网易和雅虎等门户网站（包括行业门户）。 [3] 
5.在邮件营销领域，ISP主要指电子邮箱服务商
RFC 6650给电子邮箱服务商的定义是：为终端用户提供邮件发送、接收、存储服务的公司或组织。这个定义涵盖了电子邮件托管服务、以及自主管理邮件服务器的公司、大学、机构和个人。 
常见的电子邮件服务商，国内有网易、腾讯、新浪、搜狐等主流ISP。国外常见的有Gmail、Yahoo、Hotmail、AOL等。 [3] 
国内外ISP
国内外ISP
这些ISP通常通过执行邮件传输协议（SMTP）、交互式邮件存取协议（IMAP）、邮局协议(POP) 及其他专有协议进行信息的传输和获取


ISP衡量指标

选择ISP主要应当注意以下几个方面。  
资质
选择ISP时，首先应该核实ISP的资质。只有拥有ISP增值电信许可证的公司，才有资格从事因特网接入服务的业务。同时，还应当了解该ISP的成立时间以及行业经验。行业经验丰富的ISP同时也意味着更好的信誉和服务质量。  
服务性能
性能保证应该是寻求合格ISP的一个最重要因素。这一特性应该在ISP服务合同中进行谈判和明确加以定义。与此同时，还应考察ISP的服务合同中是否包括了，当服务合同未能满足规定要求时应承担违约罚金的条款。  
ISP的服务性能会受到多方面因素的影响，因此对所要选择的ISP的服务性能应从多方面进行考察，这些主要因素如下：  
①可靠性。可靠性包括硬件、软件设备及专线的稳定性和可靠性；是否出现过服务器损坏而导致长时不能上网的现象；是否出现过用户数据丢失，用户计费系统出错等问题。可以用用户可正常访问Internet的服务时间百分比或拨号访问的电话连接率的百分比来衡量。一般来说，低于99.9%的正常服务时间都是不可接受的。对于那些局部基础设施比较落后的地区而言，企业必须把ISP服务的可靠性作为一个独立的服务条款与ISP谈判。  
②速率。可以用三个重要指标来衡量速率。第一是接入速率，即当用户计算机与ISP建立连接时，ISP提供的最快速率是多少。这个速率根据接入方式的不同而不同。第二是ISP连接到几大基础网络运营商的速率，如果ISP连接到国际出口的DDN专线速率较慢时，对我们上网速率也有很大的制约。专线速率一般有128kb/s、256kb/s、2Mb/s、4Mb/s等，一定要选择最快的。第三点是所连接的基础网络运营商的国际出口速率，出口速率当然越快越好。  
③安全性。ISP服务的安全性也是必须加以考察的一个重要因素。目前，大多数ISP所提供的服务都具有一定程度的安全性。在选择ISP时，必须要求它们能够提供对防火墙、远程监视以及安全咨询特性的支持。ISP应该能够为在线的、基于路由器的封闭用户以及非在线网点的、拨号登录的远程访问用户提供相应的加密功能。

服务项目
Internet可提供的服务项目种类很多，每个ISP提供的项目又各不相同。有的提供了Internet全部服务项目。有的只提供电子邮件、页面浏览、文件传输、远程登录等Internet基本服务项目。ISP之间的差别，正越来越多地取决于它们所能提供的增值服务，如主机托管、机柜租用、ISP平台出租等。

我国ISP情况

现在中国有三大基础运营商：中国电信：提供拨号上网、ADSL、CDMA等业务；中国移动：提供TD-SCDMA、GPRS及EDGE无线上网等业务；中国联通：提供GPRS、W-CDMA及CDMA无线上网、拨号上网、ADSL等业务；电信重组之后，中国网通并人中国联通，剔除中国联通CDMA，组成新联通；中国铁通并人中国移动，为其旗下全资子公司；中国联通CDMA并人中国电信组成新电信。





互联网的组成
边缘部分：所有连接在互联网上的主机，用户可以直接使用；
核心部分：由大量的网络和连接这些网络的路由器组成，为边缘部分的主机提供服务。


主机之间的通信方式
1. 客户 - 服务器（C/S）

客户即是服务请求方，服务器是服务提供方。

2. 对等（P2P）

不区分客户和服务器。


p2p通信原理及实现

1.简介

　　当今互联网到处存在着一些中间件(MIddleBoxes)，如NAT和防火墙，导致两个(不在同一内网)中的客户端无法直接通信。这些问题即便是到了IPV6时代也会存在，因为即使不需要NAT，但还有其他中间件如防火墙阻挡了链接的建立。

　　当今部署的中间件大多都是在C/S架构上设计的，其中相对隐匿的客户机主动向周知的服务端(拥有静态IP地址和DNS名称)发起链接请求。大多数中间件实现了一种非对称的通讯模型，即内网中的主机可以初始化对外的链接，而外网的主机却不能初始化对内网的链接，除非经过中间件管理员特殊配置。在中间件为常见的NAPT的情况下（也是本文主要讨论的），内网中的客户端没有单独的公网IP地址，而是通过NAPT转换，和其他同一内网用户共享一个公网IP。这种内网主机隐藏在中间件后的不可访问性对于一些客户端

软件如浏览器来说并不是一个问题，因为其只需要初始化对外的链接，从某方面来看反而还对隐私保护有好处。

　　然而在P2P应用中，内网主机（客户端）需要对另外的终端（Peer）直接建立链接，但是发起者和响应者可能在不同的中间件后面，两者都没有公网IP地址。而外部对NAT公网IP和端口主动的链接或数据都会因内网未请求被丢弃掉。本文讨论的就是如何跨越NAT实现内网主机直接通讯的问题。

 2.术语
防火墙（Firewall）：
　　防火墙主要限制内网和公网的通讯，通常丢弃未经许可的数据包。防火墙会检测(但是不修改)试图进入内网数据包的IP地址和TCP/UDP端口信息。

网络地址转换器（NAT）：
　　NAT不止检查进入数据包的头部，而且对其进行修改，从而实现同一内网中不同主机共用更少的公网IP（通常是一个）。

基本NAT（Basic NAT）：
　　基本NAT会将内网主机的IP地址映射为一个公网IP，不改变其TCP/UDP端口号。基本NAT通常只有在当NAT有公网IP池的时候才有用。

网络地址-端口转换器（NAPT）：
　　到目前为止最常见的即为NAPT，其检测并修改出入数据包的IP地址和端口号，从而允许多个内网主机同时共享一个公网IP地址。

锥形NAT（Cone NAT）：
　　在建立了一对（公网IP，公网端口）和（内网IP，内网端口）二元组的绑定之后，Cone NAT会重用这组绑定用于接下来该应用程序的所有会话（同一内网IP和端口），只要还有一个会话还是激活的。

　　例如，假设客户端A建立了两个连续的对外会话，从相同的内部端点（10.0.0.1:1234）到两个不同的外部服务端S1和S2。Cone NAT只为两个会话映射了一个公网端点（155.99.25.11:62000），确保客户端端口的“身份”在地址转换的时候保持不变。由于基本NAT和防火墙都不改变数据包的端口号，因此这些类型的中间件也可以看作是退化的Cone NAT。



对称NAT（Symmetric NAT）
　　对称NAT正好相反，不在所有公网-内网对的会话中维持一个固定的端口绑定。其为每个新的会话开辟一个新的端口。


其中Cone NAT根据NAT如何接收已经建立的（公网IP，公网端口）对的输入数据还可以细分为以下三类：

1) 全锥形NAT（Full Cone NAT）
　　在一个新会话建立了公网/内网端口绑定之后，全锥形NAT接下来会接受对应公网端口的所有数据，无论是来自哪个（公网）终端。全锥NAT有时候也被称为“混杂”NAT（promiscuous NAT）。

2) 受限锥形NAT（Restricted Cone NAT）
　　受限锥形NAT只会转发符合某个条件的输入数据包。条件为：外部（源）IP地址匹配内网主机之前发送一个或多个数据包的结点的IP地址。受限NAT通过限制输入数据包为一组“已知的”外部IP地址，有效地精简了防火墙的规则。

3) 端口受限锥形NAT（Port-Restricted Cone NAT）
　　端口受限锥形NAT也类似，只当外部数据包的IP地址和端口号都匹配内网主机发送过的地址和端口号时才进行转发。端口受限锥形NAT为内部结点提供了和对称NAT相同等级的保护，以隔离未关联的数据。


P2P通信
　　根据客户端的不同，客户端之间进行P2P传输的方法也略有不同，这里介绍了现有的穿越中间件进行P2P通信的几种技术。

3.1 中继（Relaying）
　　这是最可靠但也是最低效的一种P2P通信实现。其原理是通过一个有公网IP的服务器中间人对两个内网客户端的通信数据进行中继和转发。


客户端A和客户端B不直接通信，而是先都与服务端S建立链接，然后再通过S和对方建立的通路来中继传递的数据。这钟方法的缺陷很明显，当链接的客户端变多之后，会显著增加服务器的负担，完全没体现出P2P的优势。

3.2 逆向链接（Connection reversal）
　　第二种方法在当两个端点中有一个不存在中间件的时候有效。例如，客户端A在NAT之后而客户端B拥有全局IP地址，


客户端A内网地址为10.0.0.1，且应用程序正在使用TCP端口1234。A和服务器S建立了一个链接，服务器的IP地址为18.181.0.31，监听1235端口。NAT A给客户端A分配了TCP端口62000，地址为NAT的公网IP地址155.99.25.11，作为客户端A对外当前会话的临时IP和端口。因此S认为客户端A就是155.99.25.11:62000。而B由于有公网地址，所以对S来说B就是138.76.29.7:1234。

　　当客户端B想要发起一个对客户端A的P2P链接时，要么链接A的外网地址155.99.25.11:62000，要么链接A的内网地址10.0.0.1:1234，然而两种方式链接都会失败。链接10.0.0.1:1234失败自不用说，为什么链接155.99.25.11:62000也会失败呢？来自B的TCP SYN握手请求到达NAT A的时候会被拒绝，因为对NAT A来说只有外出的链接才是允许的。

　　在直接链接A失败之后，B可以通过S向A中继一个链接请求，从而从A方向“逆向“地建立起A-B之间的点对点链接。

　　很多当前的P2P系统都实现了这种技术，但其局限性也是很明显的，只有当其中一方有公网IP时链接才能建立。越来越多的情况下，通信的双方都在NAT之后，因此就要用到我们下面介绍的第三种技术了。

UDP打洞（UDP hole punching）
　　第三种P2P通信技术，被广泛采用的，名为“P2P打洞“。P2P打洞技术依赖于通常防火墙和cone NAT允许正当的P2P应用程序在中间件中打洞且与对方建立直接链接的特性。以下主要考虑两种常见的场景，以及应用程序如何设计去完美地处理这些情况。第一种场景代表了大多数情况，即两个需要直接链接的客户端处在两个不同的NAT之后；第二种场景是两个客户端在同一个NAT之后，但客户端自己并不需要知道。

端点在不同的NAT之下
　　假设客户端A和客户端B的地址都是内网地址，且在不同的NAT后面。A、B上运行的P2P应用程序和服务器S都使用了UDP端口1234，A和B分别初始化了与Server的UDP通信


现在假设客户端A打算与客户端B直接建立一个UDP通信会话。如果A直接给B的公网地址138.76.29.7:31000发送UDP数据，NAT B将很可能会无视进入的数据（除非是Full Cone NAT），因为源地址和端口与S不匹配，而最初只与S建立过会话。B往A直接发信息也类似。

　　假设A开始给B的公网地址发送UDP数据的同时，给服务器S发送一个中继请求，要求B开始给A的公网地址发送UDP信息。A往B的输出信息会导致NAT A打开一个A的内网地址与与B的外网地址之间的新通讯会话，B往A亦然。一旦新的UDP会话在两个方向都打开之后，客户端A和客户端B就能直接通讯，而无须再通过引导服务器S了。

　　UDP打洞技术有许多有用的性质。一旦一个的P2P链接建立，链接的双方都能反过来作为“引导服务器”来帮助其他中间件后的客户端进行打洞，极大减少了服务器的负载。应用程序不需要知道中间件具体是什么（如果有的话），因为以上的过程在没有中间件或者有多个中间件的情况下也一样能建立通信链路。


端点在相同的NAT之下
　　现在考虑这样一种情景，两个客户端A和B正好在同一个NAT之后（而且可能他们自己并不知道），因此在同一个内网网段之内。客户端A和服务器S建立了一个UDP会话，NAT为此分配了公网端口62000，B同样和S建立会话，分配到了端口62001


假设A和B使用了上节介绍的UDP打洞技术来建立P2P通路，那么会发生什么呢？首先A和B会得到由S观测到的对方的公网IP和端口号，然后给对方的地址发送信息。两个客户端只有在NAT允许内网主机对内网其他主机发起UDP会话的时候才能正常通信，我们把这种情况称之为"回环传输“(lookback translation)，因为从内部到达NAT的数据会被“回送”到内网中而不是转发到外网。例如，当A发送一个UDP数据包给B的公网地址时，数据包最初有源IP地址和端口地址10.0.0.1:1234和目的地址155.99.25.11:62001，NAT收到包后，将其转换为源155.99.25.11:62000（A的公网地址）和目的10.1.1.3:1234，然后再转发给B。即便NAT支持回环传输，这种转换和转发在此情况下也是没必要的，且有可能会增加A与B的对话延时和加重NAT的负担。

　　对于这个问题，解决方案是很直观的。当A和B最初通过S交换地址信息时，他们应该包含自身的IP地址和端口号（从自己看），同时也包含从服务器看的自己的地址和端口号。然后客户端同时开始从对方已知的两个的地址中同时开始互相发送数据，并使用第一个成功通信的地址作为对方地址。如果两个客户端在同一个NAT后，发送到对方内网地址的数据最有可能先到达，从而可以建立一条不经过NAT的通信链路；如果两个客户端在不同的NAT之后，发送给对方内网地址的数据包根本就到达不了对方，但仍然可以通过公网地址来建立通路。值得一提的是，虽然这些数据包通过某种方式验证，但是在不同NAT的情况下完全有可能会导致A往B发送的信息发送到其他A内网网段中无关的结点上去的。


固定端口绑定
　　UDP打洞技术有一个主要的条件：只有当两个NAT都是Cone NAT（或者非NAT的防火墙）时才能工作。因为其维持了一个给定的（内网IP，内网UDP）二元组和（公网IP， 公网UDP）二元组固定的端口绑定，只要该UDP端口还在使用中，就不会变化。如果像对称NAT一样，给每个新会话分配一个新的公网端口，就会导致UDP应用程序无法使用跟外部端点已经打通了的通信链路。由于Cone NAT是当今最广泛使用的，尽管有一小部分的对称NAT是不支持打洞的，UDP打洞技术也还是被广泛采纳应用。

具体实现
　　如果理解了上面所说的内容，那么代码实现起来倒很简单了 。这里采用C++的异步IO库来实现引导服务器和P2P客户端的简单功能，目的是打通两个客户端的通信链路，使两个不同局域网之间的客户端可以实现直接通信。

引导服务端设计
　　引导服务器运行在一个有公网地址的设备上，并且接收指定端口的来自客户的命令（这里是用端口号2333）。

客户端其实可以而且也最好应该与服务器建立TCP链接，但我这里为了图方便，也只采用了UDP的通信方式。服务端监听2333端口的命令，然后执行相应的操作，目前包含的命令有:

login， 客户端登录，使得其记录在服务器traker中，让其他peer可以对其发出链接请求。

logout，客户端登出，使其对peer隐藏。因为服务器不会追踪客户端的登录状态。

list，客户端查看目前的登录用户。

punch <client>， 对指定用户（序号）进行打洞。

help， 查看有哪些可用的命令。


P2P客户端设计
　　一般的网络编程，都是客户端比服务端要难，因为要处理与服务器的通信同时还要处理来自用户的事件；对于P2P客户端来说更是如此，因为P2P客户端不止作为客户端，同时也作为对等连接的服务器端。

这里的大体思路是，输入命令传输给服务器之后，接收来自服务器的反馈，并执行相应代码。例如A想要与B建立通信链路，先给服务器发送punch命令以及给B发送数据，服务器接到命令后给B发送punch_requst信息以及A的端点信息，B收到之后向A发送数据打通通路，然后A与B就可以进行P2P通信了。经测试，打通通路后即便把服务器关闭，A与B也能正常通信。

电路交换
电路交换用于电话通信系统，两个用户要通信之前需要建立一条专用的物理链路，并且在整个通信过程中始终占用该链路。由于通信的过程中不可能一直在使用传输线路，因此电路交换对线路的利用率很低，往往不到 10%。


报文交换
报文交换用于邮局通信系统，邮局接收到一份报文之后，先存储下来，然后把相同目的地的报文一起转发到下一个目的地，这个过程就是存储转发过程。

分组交换
分组交换也使用了存储转发，但是转发的是分组而不是报文。把整块数据称为一个报文，由于一个报文可能很长，需要先进行切分，来满足分组能处理的大小。在每个切分的数据前面加上首部之后就成为了分组，首部包含了目的地址和源地址等控制信息。



存储转发允许在一条传输线路上传送多个主机的分组，因此不需要占用端到端的线路资源。

相比于报文交换，由于分组比报文更小，存储转发的速度也就更快。

	
时延
总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延


发送时延
主机或路由器发送数据帧所需要的时间。


发送时延是指结点在发送数据时使数据块从结点进入到传输媒体所需的时间，也就是从数据块的第一个比特开始发送算起，到最后一个比特发送完毕所需的时间。发送时延又称为传输时延，它的计算公式是：
发送时延=数据帧长度/发送速率
发送时延是指结点在发送数据时使数据块从结点进入到传输媒体所需的时间，也就是从数据块的第一个比特开始发送算起，到最后一个比特发送完毕所需的时间。发送时延又称为传输时延，它的计算公式是：
发送时延=数据帧长度/发送速率
信道带宽就是数据在信道上的最大发送速率，它也常称为数据在信道上的最大传输速率


传播时延
电磁波在信道中传播一定的距离需要花费的时间，电磁波传播速度接近光速。


传播时延是指电磁信号或光信号在传输介质中传播一定的距离所花费的时间，即从发送端发送数据开始，到接收端收到数据（或者从接收端发送确认帧，到发送端收到确认帧），总共经历的时间。
电磁信号和光信号在光纤或者铜线中的传播速度在20万公里/秒以上

电磁波在信道中传播一定的距离需要花费的时间，也就是一个比特从链路一端到另一端传播所需要的时间。
计算公式如下：
传播时延=传输信道长度/传输介质中信号的传播速率
电磁波在自由空间的传播速率是光速，即 3.0*10^5km/s 



电磁波在网络传输媒体中的传播速率比在自由空间要略低一些。例如，电磁波在铜线电缆中的传播速率约为 2.3*10^5km/s 


 电磁波在光纤中的传播速率约为   2.0*10^5km/s 



 如果光纤线路长度为1000 km。则产生的传播时延为    1000/(2.0*10^5) =5 ms 
 
 
 易混淆的两个概念是传播时延和传输时延。传输时延是指一个站点从开始发送数据帧到数据帧发送完毕所需要的全部时间，传播时延是指发送端开始发送数据到接收端收到数据所需要的全部时间。传输时延和发送数据帧大小有关，而传播时延和传输距离相关 



处理时延 


传播延迟、传输延迟、处理延时以及排队时延等概念的一些类比理解

一条公路（链路）开始处有收费站（路由器），收费站出站就会有不同的去处（路由功能），假定一个汽车车队（分组报文）以100km/h的恒定速度在公路上行驶，那就得依次从进收费站到出收费站，行驶的这段时间就是传播时延。可是在进收费站之前，先得缴费啊，而且你还不能开得太快。而收费站门口的工作人员处理给你发卡的时间假设是10s，那他一分钟就能让六辆车进入高速公路。进入高速之前的这段在收费站的时间，就是限制车辆（bits）不能瞬间涌入高速的时间。也可看作为是所有车队（分组报文）中的汽车（bits）发卡允许进入（传输，或者推向）高速公路（链路）所需要的时间。这个时间就叫做传输时延。

假设汽车以光速行驶（传播速率），则在后一辆车还在等待收费站入口处工作人员慢吞吞地发来的卡的时候（传输速率），前一辆车早已到达下一个收费站准备出站了（实际上前一辆车都可以绕着地球转七圈了）。所以这时候在车队后部分的车还在等发卡的时候（传输速率慢，等待传输），车队前面几辆车已经光速到了下一个收费站。地球上一般不考虑传播延迟吧？除非是汽车开上了火星（好奇者号），从地球发信号在火星上要十几分钟才能收到。。

传输时延是分组长度（车队的车数）和链路传输速率（工作人员发卡给你的快慢）的函数。

而传播时延则是两个收费站（路由器）之间的距离和汽车速度（传播速率）的函数。

排队时延好理解，先来的先拿卡过闸呗（推出路由器）

处理时延不太好用收费站的类比。。实在要强行类比的话，可能是收费站工作人员检查一下你的车牌是否套牌？汽车是否爆胎？检查一下车要往哪开？身份证行车证驾驶证是否过期？。。。实际上处理时延通常是在微秒或者更低的数量级的。。

时延带宽积=传播时延*带宽，我理解的是，在第一辆车驶出收费站但还未到达下一个收费站时，这条高速路最多能够容纳的车的数目。按李全龙老师课上的内容来看，是指：这个链路上能容纳多少个比特，或是以比特为单位的链路长度。

下面就试着以类比的观点来看看这个题吧。

假设左边路由器为E，右边路由器为F。

1.若是报文交换，则就不分组了。假设还是一辆车吧，这辆车很长（报文很大），还可以伸缩（路飞的手，像橡皮筋一样）。由于进出收费站必须缓慢行驶（传输速率），所以在还没出收费站（这时候是A主机不是路由器）之前的车身必须缓慢经过收费站，而出了收费站A之后的车身则瞬间到达下一个收费站（马上以光速行驶（忽略传播延迟）），这辆车中途不会断裂，但却是连接上的（逻辑上的连接）。车身长2Mb，驶出收费站的速度是10Mb/s,所以把整个车身弄出收费站要花费0.2s。但在车身出收费站一半的时候（0.1s），隔壁的一个收费站（B主机）也开始运输一辆车，再经过0.1s，A和B同时在下一个收费站汇合完毕，此时的车已收回原来的长度，但因为A车车头是先到的，所以收费站优先让A通过，B则在排队。等到A以同样的方式（整体伸缩）出收费站后，才轮到B。所以这里面对于B来说，有一个排队时间（也就是A通过收费站的时间2/10s）。随后A顺利地再由下一个收费站到达终点C。其中无任何排队时间。对于A来说整个流程是无任何排队时间的。而在B排过一次队以后，就不用再排了，所以对于B来说以后的传输时延是正常计算的。

2.若是分组交换，则将很长的一辆车分割成一个车队，这个车队A有2000辆车。车队B则有1000辆车。在前0.1秒（车队B没开始传输的时候），车队A以很低的传输时延进行传输（瞬间到达下一个收费站），传输了1000辆车（2000*0.1/（2/10））。车队早期到达下一个收费站（E）的车又由下一个收费站推向下下一个收费站（F）。这或许就是分组交换在传输时延方面优于报文交换的理由之一吧，即充分调用了各收费站的能力，让各收费站（路由器）对自己车队的汽车（分组）进行同时处理。

而在0.1秒后，车队A和车队B开始传输各自的车队（B在t=0.1+e秒向发送一个文件，即A稍微比B提早一点开始传输剩余车队的第一辆车）。这时，收费站门口堆积起来的车是A-B-A-B-A-B交错排队的。所以在收费站进行处理时，是依次将这个队列推向下一个收费站的。对于A、B俩车队来说，各自的排队时间是均等的。

（E-F段的带宽为20Mbps，从链路带宽共享的角度来看，平均各共享到10Mbps的链路带宽资源）

（另一个角度想，20Mbps的带宽处理一个1k的分组需要时间为0.05ms，而A、B的排队时间又是一样的，所以可以认为，此时传输一个A的分组即需要两倍正常传输一个A分组的时间，即0.1ms，因为此时A与B共享链路带宽）

（A-E段的链路带宽为10Mbps，而E-F段共享后的A享受到的链路带宽恰好也为10Mbps，这应该是设计好的吧，若把一个A+B看成是一个分组从E到F传输，则从E结点看，进入E结点的A的分组与从E出去的A的分组在相同时间内是平衡的）

链路带宽到达F后即正常由路由器分别向C、D转发分组。所以此时的传输时延正常计算。



分组交换的分组序列不确定，可按需共享链路带宽，即实现统计多路复用！




处理时延
主机或路由器收到分组时进行处理所需要的时间，例如分析首部，从分组中提取数据部分等。

排队时延
分组在路由器的输入队列和输出队列中排队等待的时间，取决于网络当前的通信量。


计算机网络体系结构*


1. 七层协议
如图 a 所示，其中表示层和会话层用途如下：

表示层：信息的语法语义以及它们的关联，如加密解密、转换翻译、压缩解压缩；
会话层：不同机器上的用户之间建立及管理会话。



2. 五层协议
应用层：为特定应用程序提供数据传输服务，例如 HTTP、DNS 等。数据单位为报文。

运输层：提供的是进程间的通用数据传输服务。由于应用层协议很多，定义通用的运输层协议就可以支持不断增多的应用层协议。运输层包括两种协议：传输控制协议 TCP，提供面向连接、可靠的数据传输服务，数据单位为报文段；用户数据报协议 UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。

网络层：为主机之间提供服务，而不是像运输层协议那样是为主机中的进程提供服务。网络层把运输层产生的报文段或者用户数据报封装成分组来进行传输。

数据链路层：网络层针对的还是主机之间，而主机之间可以有很多链路，链路层协议就是为相邻结点之间提供服务。数据链路层把网络层传来的分组封装成帧。

物理层：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使物理层上的数据链路层感觉不到这些差异。



3. 数据在各层之间的传递过程
在向下的过程中，需要添加下层协议所需要的首部或者尾部，而在向上的过程中不断拆开首部和尾部。

路由器只有下面三层协议，因为路由器位于网络核心中，不需要为进程或者应用程序提供服务，因此也就不需要运输层和应用层。



4. TCP/IP 体系结构
它只有四层，相当于五层协议中数据链路层和物理层合并为网络接口层。

现在的 TCP/IP 体系结构不严格遵循 OSI 分层概念，应用层可能会直接使用 IP 层或者网络接口层。



TCP/IP 协议族是一种沙漏形状，中间小两边大，IP 协议在其中占用举足轻重的地位。



第二章 物理层
通信方式
单向通信，又称为单工通信；
双向交替通信，又称为半双工通信；
双向同时通信，又称为全双工通信。
带通调制
模拟信号是连续的信号，数字信号是离散的信号。带通调制把数字信号转换为模拟信号。



信道复用技术
1. 频分复用、时分复用
频分复用的所有用户在相同的时间占用不同的频率带宽资源；时分复用的所有用户在不同的时间占用相同的频率带宽资源。

使用这两种方式进行通信，在通信的过程中用户会一直占用一部分信道资源。但是由于计算机数据的突发性质，没必要一直占用信道资源而不让出给其它用户使用，因此这两种方式对信道的利用率都不高。



2. 统计时分复用
是对时分复用的一种改进，不固定每个用户在时分复用帧中的位置，只要有数据就集中起来组成时分复用帧然后发送。



3. 波分复用
光的频分复用。由于光的频率很高，因此习惯上用波长而不是频率来表示所使用的光载波。


频分复用(FDM，Frequency Division Multiplexing)就是将用于传输信道的总带宽划分成若干个子频带（或称子信道），每一个子信道传输1路信号。频分复用要求总频率宽度大于各个子信道频率之和，同时为了保证各子信道中所传输的信号互不干扰，应在各子信道之间设立隔离带，这样就保证了各路信号互不干扰（条件之一）。频分复用技术的特点是所有子信道传输的信号以并行的方式工作，每一路信号传输时可不考虑传输时延，因而频分复用技术取得了非常广泛的应用。频分复用技术除传统意义上的频分复用(FDM)外，还有一种是正交频分复用(OFDM)。


频分复用的基本思想是：要传送的信号带宽是有限的，而线路可使用的带宽则远远大于要传送的信号带宽，通过对多路信号采用不同频率进行调制的方法，使调制后的各路信号在频率位置上错开，以达到多路信号同时在一个信道内传输的目的。因此，频分复用的各路信号是在时间上重叠而在频谱上不重叠的信号。

下图中(a)(b)是一个以三路话音信号为例的频分复用原理发送端和接收端图。图中，LPF是低通滤波器，滤波器下方表明了滤波器的截止角频率；BPF是带通滤波器，滤波器下方表明了带通滤波器的中心角频率。
由于是话音信号，因此，其有效频率被低通限制在3.4kHz以内，通过调制器取上边带后相加，相加器的输出频谱如图1(c)所示。然后进行第二次调制，载波角频率，用带通滤波器取上边带送入信道。收端首先通过带通滤波器取得信道中传输的信号，并阻止带外噪声的影响，经解调器解调后，由分路带通滤波器分别取出相应的各路信号，再经解调器解调得三路信号f1(t)，f2(t)，f3(t), 如图1(b)所示。
由图1(c)可见，第一次调制后取上边带所合成的频谱为  到  ，其中除了三路信号各占  宽的频带外，还有防止邻路相互干扰的邻路间隔防护频带。
这是一个复合调制系统，第二次调制只是将第一次调制后的合成频谱再进行一次频谱搬移，其频带宽度没有改变。收端解调与发端调制正好相反，恢复各路调制信号，不会带来路间干扰


原理
所谓频分复用是指按照频率的不同来复用多路信号的方法。在频分复用中，信道的带宽被分为若干个相互不重叠的频段，每路信号占用其中一个频段，因而在接受端可以采用适当的带通滤波器将多路信号分开，从而恢复出所需要的信号。
频分复用系统组成原理，各路基带信号首先通过低通波滤器限制基带信号的带宽，避免他们的频谱出现相互混叠。然后，各路信号分别对各自的载波进行调制、合成后送入信道传输。在接收端，分别采用不同中心频率的带通滤波器分离出各路已调型号，解调后恢复出基带信号。


正交
OFDM(Orthogonal Frequency Division Multiplexing)实际是一种多载波数字调制技术。OFDM全部载波频率有相等的频率间隔，它们是一个基本振荡频率的整数倍，正交指各个载波的信号频谱是正交的。
OFDM系统比FDM系统要求的带宽要小得多。由于OFDM使用无干扰正交载波技术，单个载波间无需保护频带，这样使得可用频谱的使用效率更高。另外，OFDM技术可动态分配在子信道中的数据，为获得最大的数据吞吐量，多载波调制器可以智能地分配更多的数据到噪声小的子信道上。OFDM技术已被广泛应用于广播式的音频和视频领域以及民用通信系统中，主要的应用包括：非对称的数字用户环线(ADSL)、数字视频广播(DVB)、高清晰度电视(HDTV)、无线局域网(WLAN)和第4代(4G)移动通信系统等。

传统方式
传统的频分复用典型的应用莫过于广电HFC网络电视信号的传输了，不管是模拟电视信号还是数字电视信号都是如此，因为对于数字电视信号而言，尽管在每一个频道(8 MHz)以内是时分复用传输的，但各个频道之间仍然是以频分复用的方式传输的



关键技术
同步技术
与其它数字通信系统一样，OFDM系统需要可靠的同步技术，包括定时同步、频率同步和相位同步，其中频率同步对系统的影响最大。移动无线信道存在时变性，在传输过程中会出现无线信号的频率偏移，这会使OFDM系统子载波间的正交性遭到破坏，使子信道间的信号相互干扰，因此频率同步是OFDM系统的一个重要问题。为了不破坏子载波间的正交性，在接收端进行FFT变换前，必须对频率偏差进行估计和补偿。
可采用循环前缀方法对频率进行估计，即通过在时域内把OFDM符号的后面部分插入到该符号的开始部分，形成循环前缀。利用这一特性，可将信号延迟后与原信号进行相关运算，这样循环前缀的相关输出就可以用来估计频率偏差。
峰值平均功率
由于OFDM信号在时域上为N个正交子载波信号的叠加，当这N个信号恰好都以峰值出现并将相加时，OFDM信号也产生最大峰值，该峰值功率是平均功率的N倍。这样，为了不失真地传输这些高峰均值比的OFDM信号，对发送端和接收端的功率放大器和A/D变换器的线性度要求较高，且发送效率较低。解决方法一般有下述三种途径：
⑴信号失真技术采用峰值修剪技术和峰值窗口去除技术，使峰值振幅值简单地非线性去除；
⑵采用编码方法将峰值功率控制和信道编码结合起来，选用合适的编码和解码方法，以避免出现较大的峰值信号；
⑶扰码技术采用扰码技术，对所产生OFDM信号的相位重新设置，使互相关性为0，这样可以减少OFDM的PAPR。这里所采用的典型方法为PTS和SLM。
信道编码和交织
为了对抗无线衰落信道中的随机错误和突发错误，通常采用信道编码和交织技术。OFDM系统本身具有利用信道分集特性的能力，一般的信道特性信息已被OFDM调整方式本身所利用，可以在子载波间进行编码，形成编码的OFDMCOFDM即把OFDM技术与信道编码、频率时间交织结合起来，提高系统的性能，其编码可以采用各种码（如分组码和卷积码）。
现状及其发展方向：OFDM技术良好的性能使其在很多领域得到了广泛的应用，如：HDSL、ADSL、VDSL、DAB和DVB，无线局域网IEEE802.11a和HIPERLAN2，以及无线城域网IEEE802.16等系统中。而在4G中，一方面带宽作为移动通信中非常希缺的资源，另一方面未来的移动通信对服务质量、服务的多样性及传输速率要求越来越高，使得OFDM将得到更广泛的应用




频率复用系统的最大优点是信道复用率高，允许复用的路数多，同时它的分路也很方便。因此，它是模拟通信中最主要的一种复用方式，特别是在有线、微波通信系统及卫星通信系统内广泛应用。例如，在卫星通信系统中的频分多址(FDMA)方式，就是按照频率的不同，把各地球站发射的信号安排在卫星频带内的指定位置进行频分复用，然后，按照频率不同来区分地球站站址，进行多址复用。
· 有效减少多径及频率选择性信道造成接收端误码率上升的影响；
· 接收端可利用简单一阶均衡器补偿信道传输的失真；
· 频谱效率上升。

优点
频率复用系统的最大优点是信道复用率高，允许复用的路数多，同时它的分路也很方便。因此，它是模拟通信中最主要的一种复用方式，特别是在有线、微波通信系统及卫星通信系统内广泛应用。例如，在卫星通信系统中的频分多址(FDMA)方式，就是按照频率的不同，把各地球站发射的信号安排在卫星频带内的指定位置进行频分复用，然后，按照频率不同来区分地球站站址，进行多址复用。
· 有效减少多径及频率选择性信道造成接收端误码率上升的影响；
· 接收端可利用简单一阶均衡器补偿信道传输的失真；
· 频谱效率上升。

缺点
频率复用系统的不足之处是收发两端需要大量载频，且相同载频必须同步，设备较复杂。另外，还需要大量的各种频带范围的边带滤波器。对它们的要求不仅是频带特性陡峭，而且对频率的准确性和元件的稳定性都要求很高。第三频率复用系统不可避免地产生路间干扰。其原因除了分路用的带通滤波器特性不够理想外，最主要是信道本身存在着非线性特性。例如，多路复用信号通过公用的放大器时，由于放大器的非线性失真会引起各路信号频谱交叉重叠，这样会带来路间干扰，通常在传输话音信号时称为路间串话。因此，为了提高传输质量，对信道的线性指标有严格的要求。
· 传送与接收端需要精确的同步；
· 对于多普勒效应频率漂移敏感；
· 峰均比高；
· 循环前缀（Cyclic Prefix）造成的负荷。

相关区别
频分复用（FDM，Frequency Division Multiplexing）就是将用于传输信道的总带宽划分成若干个子频带（或称子信道），每一个子信道传输1路信号。频分复用要求总频率宽度大于各个子信道频率之和，同时为了保证各子信道中所传输的信号互不干扰，应在各子信道之间设立隔离带，这样就保证了各路信号互不干扰（条件之一）。频分复用技术的特点是所有子信道传输的信号以并行的方式工作，每一路信号传输时可不考虑传输时延
时分复用（TDM，Time Division Multiplexing）就是将提供给整个信道传输信息的时间划分成若干时间片（简称时隙），并将这些时隙分配给每一个信号源使用，每一路信号在自己的时隙内独占信道进行数据传输。时分复用技术的特点是时隙事先规划分配好且固定不变，所以有时也叫同步时分复用。其优点是时隙分配固定，便于调节控制，适于数字信息的传输；缺点是当某信号源没有数据传输时，它所对应的信道会出现空闲，而其他繁忙的信道无法占用这个空闲的信道，因此会降低线路的利用率。


时分复用(Time Division Multiplexing,TDM)
时分复用TDM是采用同一物理连接的不同时段来传输不同的信号，也能达到多路传输的目的。时分多路复用以时间作为信号分割的参量，故必须使各路信号在时间轴上互不重叠。时分复用（TDM，Time-division multiplexing）就是将提供给整个信道传输信息的时间划分成若干时间片(简称时隙)，并将这些时隙分配给每一个信号源使用。


基本原理

时分多路复用适用于数字信号的传输。由于信道的位传输率超过每一路信号的数据传输率,因此可将信道按时间分成若干片段轮换地给多个信号使用。每一时间片由复用的一个信号单独占用,在规定的时间内,多个数字信号都可按要求传输到达,从而也实现了一条物理信道上传输多个数字信号。假设每个输入的数据比特率是9. 6kbit / s ,线路的最大比特率为76. 8 kbit / s ,则可传输8 路信号。在接收端，复杂的解码器通过接收一些额外的信息来准确地区分出不同的数字信号。

特点

时分复用是建立在抽样定理基础上的。抽样定理使连续(模拟)的基带信号有可能被在时间上离散出现的抽样脉冲值所代替。这样，当抽样脉冲占据较短时间时，在抽样脉冲之间就留出了时间空隙，利用这种空隙便可以传输其他信号的抽样值。因此，这就有可能沿一条信道同时传送若干个基带信号。

时分复用技术


时分复用技术（time-division multiplexing, TDM）是将不同的信号相互交织在不同的时间段内，沿着同一个信道传输；在接收端再用某种方法，将各个时间段内的信号提取出来还原成原始信号的通信技术。这种技术可以在同一个信道上传输多路信号。


应用扩展

TDM方式又分为以下两种
同步时分复用系统（分两类）：
1、 准同步系列PDH(用于公共电话网PSTN）。
2、同步系列SDH（用于光纤通信等骨干网络）
统计(异步)时分复用系统（分两类）：
1、 虚电路方式（如，X.25、帧中继、ATM）。
2、 数据报方式（如TCP/IP）
PSTN系统采用PDH和SDH结合的方式，在小用户接入及交换采用PCM/PDH，核心骨干网络采用SDH。
世界上存在两类的PDH标准
1、 基于A律压缩的30/32路PCM系统（欧洲标准，用于欧洲、中国、俄罗斯等）
2、 基于u律压缩的24路PCM系统（美洲标准，用于北美、日本、台湾等）
时间片划分：
同步(Synchronous)时分多路复用TDM,它的时间片是预先分配好的,而且是固定不变的,因此各种信号源的传输定时是同步的。与此相反,异步时分多路复用1DM允许动态地分配传输媒体的时间片。
发展：
传统的电路时分复用技术虽然已经成熟，但是由于电子瓶颈的影响很难进一步提高单根光纤的传输速率。利用电时分复用的方式可以实现单根光纤10Gbit/s 的传输速率，德国SHF 40Gbit/s 电时分复用器虽然已经商用化，但是由于技术复杂，价格十分昂贵。所以要想进一步提高光通信系统的通信容量，人们把研究的热点集中在了光波分复用（WDM）和光时分复用（OTDM）两种复用方式上。
WDM 是在一根光纤上复用多路不同波长的光信号，在接收端分别对不同波长进行解复用。由于增益平坦EDFA 的发展，推动了WDM 技术的发展，WDM 已经日趋成熟。OTDM 在一根光纤上只传输一个波长的光信号，它首先要求光脉冲必须是RZ 码，各路光信号通过占用不同时隙复用成一路，即在一路光脉冲之间插入几路相对于第一路具有不同时延的光脉冲，以提高单根光纤的传输速率。WDM 和OTDM 各有其优点，因此可以预见，WDM 与OTDM 相结合将更大地提高光通信容量，成为未来光通信发展的一个趋势。



统计时分复用
是对时分复用的一种改进，不固定每个用户在时分复用帧中的位置，只要有数据就集中起来组成时分复用帧然后发送
统计时分复用（Statistical Time Division Multiplexing）是一种根据用户实际需要动态分配线路资源的时分复用方法。只有当用户有数据要传输时才给他分配线路资源，当用户暂停发送数据时，不给他分配线路资源，线路的传输能力可以被其他用户使用。采用统计时分复用时，每个用户的数据传输速率可以高于平均速率，最高可达到线路总的传输能力。

时分复用
时分复用是指将时间分成若干个时隙（timeslot），每个时隙对应一个信道。如果该信道被某特定用户固定使用，如传统电路交换网中。也就是说不管有没有信息传送，该信道都不能被其他用户使用。如果该信道能被多用户复用，则为统计时分复用。统计时分复用有两种方式：面向连接的虚电路方式和面向无连接方式。如ATM网络就是前者，IP网络就是后者。

统计时分复用
也叫异步时分复用：将所需传输的信息分成小块，附加标记。同一路信号可以占用同一桢中的不同时隙，不同路的信号根据标记加以区分。按照分组中的路由标记寻找出线。标志化信道异步时分多路复用（ATDM，AsynchronismTime-DivisionMultiplexing）技术，也叫做统计时分多路复用技术（STDM，StatisticTime-DivisionMultiplexing）。指的是将用户的数据划分为一个个数据单元，不同用户的数据单元仍按照时分的方式来共享信道；但是不再使用物理特性来标识不同用户，而是使用数据单元中的若干比特，也就是使用逻辑的方式来标识用户。
这种方法提高了设备利用率，但是技术复杂性也比较高，所以这种方法主要应用于高速远程通信过程中，例如，异步传输模式ATM。
一种被用来增加整体数据速率的技术称为统计时分多路复用技术。这种技术简单实用：以轮流方式选择数据项传输，跳过未准备好发送数据的源，而不去保留未填充的空闲时隙。通过消除这种未填充的时隙，统计TDM就可以使用更少的时间来发送等量数据。


 波分复用
光的频分复用。由于光的频率很高，因此习惯上用波长而不是频率来表示所使用的光载波。
波分复用WDM(Wavelength Division Multiplexing)是将两种或多种不同波长的光载波信号（携带各种信息）在发送端经复用器(亦称合波器，Multiplexer)汇合在一起，并耦合到光线路的同一根光纤中进行传输的技术；在接收端，经解复用器(亦称分波器或称去复用器，Demultiplexer)将各种波长的光载波分离，然后由光接收机作进一步处理以恢复原信号。这种在同一根光纤中同时传输两个或众多不同波长光信号的技术，称为波分复用。
在同一根光纤中同时让两个或两个以上的光波长信号通过不同光信道各自传输信息，称为光波分复用技术，简称WDM。


复用类型
光波分复用包括频分复用和波分复用
光频分复用（FDM）技术和光波分复用（WDM）技术无明显区别，因为光波是电磁波的一部分，光的频率与波长具有单一对应关系。通常也可以这样理解，光频分复用指光频率的细分，光信道非常密集。光波分复用指光频率的粗分，光信道相隔较远，甚至处于光纤不同窗口。
结构
光波分复用一般应用波长分割复用器和解复用器（也称合波/分波器）分别置于光纤两端，实现不同光波的耦合与分离。这两个器件的原理是相同的

波分复用器
光波分复用器的主要类型有熔融拉锥型，介质膜型，光栅型和平面型四种
性能指标
其主要特性指标为插入损耗和隔离度
由于光链路中使用波分复用设备后，光链路损耗的增加量称为波分复用的插入损耗。当波长λ1,λ2通过同一光纤传送时，在与分波器中输入端λ2的功率与λ1输出端光纤中混入的功率之间的差值称为隔离度。
光波分复用器特点&优势
充分利用光纤的低损耗波段，增加光纤的传输容量，使一根光纤传送信息的物理限度增加一倍至数倍。目前我们只是利用了光纤低损耗谱（1310nm-1550nm）极少一部分，波分复用可以充分利用单模光纤的巨大带宽约25THz，传输带宽充足。
具有在同一根光纤中，传送2个或数个非同步信号的能力，有利于数字信号和模拟信号的兼容，与数据速率和调制方式无关，在线路中间可以灵活取出或加入信道。
对已建光纤系统，尤其早期铺设的芯数不多的光缆，只要原系统有功率余量，可进一步增容，实现多个单向信号或双向信号的传送而不用对原系统作大改动，具有较强的灵活性。
由于大量减少了光纤的使用量，大大降低了建设成本、由于光纤数量少,当出现故障时，恢复起来也迅速方便。
有源光设备的共享性，对多个信号的传送或新业务的增加降低了成本
系统中有源设备得到大幅减少，这样就提高了系统的可靠性
现状
由于多路载波的光波分复用对光发射机、光接收机等设备要求较高，技术实施有一定难度，同时多纤芯光缆的应用对于传统广播电视传输业务未出现特别紧缺的局面，因而WDM的实际应用还不多。但是，随着有线电视综合业务的开展，对网络带宽需求的日益增长，各类选择性服务的实施、网络升级改造经济费用的考虑等等，WDM的特点和优势在CATV传输系统中逐渐显现出来，表现出广阔的应用前景，甚至将影响CATV网络的发展格局。

发展阶段
光纤通信飞速发展，光通信网络成为现代通信网的基础平台。光纤通信系统经历了几个发展阶段，从80年
代末的PDH系统，
90年代中期的SDH系统，WDM系统，光纤通信系统快速地更新换代。双波长WDM（1310/1550nm）系统80年代在美国AT&T网中使用，速率为2×17Gb/s。　应用WDM技术第一次把复用方式从电信号转移到光信号，在光域上用波分复用（即频率复用）的方式提高传输速率，光信号实现了直接复用和放大，并且各个波长彼此独立，对传输的数据格式透明。当前研究的热点之一是DWDM，DWDM实验室水平可达到100╳10Gbit/s，中继距离400km；30╳40Gbit/s，中继距离85km；64╳5Gbit/s，中继距离720km。密集波分复用DWDM商用水平为320Gbit/s，即一对光纤可传送400万话路。目前商用系统的传输能力仅是单根光纤可能传输容量为数十Tbit/s的1/100。
中国开展WDM技术的研究起步比较晚，首先在长途干线上采用WDM技术进行点到点扩容，后在节点上采用OADM、OXC技术进行上/下话路。中国于1997年引进第一套8波长WDM系统，并安装在西安至武汉的干线上。1998年中国开始大规模引进8×2.5Gb/sWDM系统，对总长达2万多km的12条省际光缆干线进行扩容改造。同时各省内干线也相继采用WDM技术扩容，如在“南昌-九江”光缆扩容工程中，采用的就是AT&T公司的设备和双窗口WDM系统，即在G.652光纤的1310nm、1550nm两个低损耗工作窗口分别运行一个系统。这样可在不拆除1310nm窗口原有PDH设备的情况下，利用未使用的1550nm窗口，加开SDH2.5Gb/s系统。为保证中国干线网的高速率、大容量并有足够的余量确保网络安全和未来发展的需要，采用WDM技术的工作已全面展开。

发展初期
90年代中期，WDM系统发展速度并不快
主要原因
TDM（时分复用）技术的发展，155Mb/s-622Mb/s-2.5Gb/sTDM技术相对简单。据统计，在2.5Gb/s系统以下（含2.5Gb/s系统），系统每升级一次，每比特的传输成本下降30%左右。因此在系统升级中，人们首先想到并采用的是TDM技术
波分复用器件不成熟。波分复用器/解复用器和光放大器在90年代初才开始商用化，1995年开始WDM技术发展很快，特别是基于掺铒光纤放大器EDFA的1550nm窗口密集波分复用（DWDM）系统。Ciena推出了16×2.5Gb/s系统，Lucent公司推出8×2.5Gb/s系统，目前试验室已达Tb/s速率。
发展迅速的原因
光电器件的迅速发展，特别是EDFA的成熟和商用化，使在光放大器（1530～1565nm）区域采用WDM技术成为可能
利用TDM方式已接近硅和镓砷技术的极限，TDM已无太多的潜力，且传输设备价格高
已敷设G.652光纤1550nm窗口的高色散限制了TDM10Gb/s系统的传输，光纤色散的影响日益严重。从电复用转移到光复用，即从光频上用各种复用方式来提高复用速率，WDM技术是能够商用化最简单的光复用技术。

技术原理

在模拟载波通信系统中，通常采用频分复用方法提高系统的传输容量，充分利用电缆的带宽资源，即在同
一根电缆中同时传输若干个信道的信号，接收端根据各载波频率的不同，利用带通滤波器就可滤出每一个信道的信号。同样，在光纤通信系统中也可以采用光的频分复用的方法来提高系统的传输容量，在接收端采用解复用器（等效于光带通滤波器）将各信号光载波分开。由于在光的频域上信号频率差别比较大，一般采用波长来定义频率上的差别，该复用方法称为波分复用。WDM技术就是为了充分利用单模光纤低损耗区带来的巨大带宽资源，根据每一信道光波的频率（或波长）不同可以将光纤的低损耗窗口划分成若干个信道，把光波作为信号的载波，在发送端采用波分复用器（合波器）将不同规定波长的信号光载波合并起来送入一根光纤进行传输。在接收端，再由一波分复用器（分波器）将这些不同波长承载不同信号的光载波分开的复用方式。由于不同波长的光载波信号可以看作互相独立（不考虑光纤非线性时），从而在一根光纤中可实现多路光信号的复用传输。将两个方向的信号分别安排在不同波长传输即可实现双向传输。根据波分复用器的不同，可以复用的波长数也不同，从2个至几十个不等，一般商用化是8波长和16波长系统，这取决于所允许的光载波波长的间隔大小。

WDM本质上是光频上的频分复用（FDM）技术。从中国几十年应用的传输技术来看，走的是FDM-TDM-TDM FDM的路线。
开始的明线、同轴电缆采用的都是FDM模拟技术，即电域上的频分复用技术，每路话音的带宽为4KHz，每路话音占据传输媒质（如同轴电缆）一段带宽；PDH、SDH系统是在光纤上传输的TDM基带数字信号，每路话音速率为64kb/s；而WDM技术是光纤上频分复用技术，16（8）×2.5Gb/s的WDM系统则是光频上的FDM模拟技术和电频率上TDM数字技术的结合。
WDM本质上是光频上的频分复用FDM技术，每个波长通路通过频域的分割实现。每个波长通路占用一段光纤的带宽，与过去同轴电缆FDM技术不同的是：（1）传输媒质不同，WDM系统是光信号上的频率分割，同轴系统是电信号上的频率分割利用。（2）在每个通路上，同轴电缆系统传输的是模拟信号4KHz语音信号，而WDM系统目前每个波长通路上是数字信号SDH2.5Gb/s或更高速率的数字系统

主要特点

WDM技术具有很多优势，得到快速发展。可利用光纤的带宽资源，使一根光纤的传输容量比单波长传输增加几倍至几十倍；多波长复用在单模光纤中传输，在大容量长途传输时可大量节约光纤；对于早期安装的电缆，芯数较少，利用波分复用无需对原有系统作较大的改动即可进行扩容操作；由于同一光纤中传输的信号波长彼此独立，因而可以传输特性完全不同的信号，完成各种电信业务信号的综合与分离，包括数字信号和模拟信号，以及PDH信号和SDH信号的综合与分离；波分复用通道对数据格式透明，即与信号速率及电调制方式无关。
一个WDM系统可以承载多种格式的“业务”信号，如ATM、IP等；在网络扩充和发展中，是理想的扩容手段，也是引入宽带新业务（例如CATV、HDTV和B-ISDN等）的有利手段，增加一个附加波长即可引入任意想要的新业务或新容量；利用WDM技术实现网络交换和恢复，从而可能实现未来透明的、具有高度生存性的光网络；在国家骨干网的传输时，EDFA的应用可以减少长途干线系统SDH中继器的数目，从而减少成本

存在的问题

以WDM技术为基础的具有分插复用和交叉连接功能的光传输网具有易于重构、良好的扩展性等优势，已成为未来高速传输网的发展方向，很好的解决下列技术问题有利于其实用化。
WDM是一项新的技术，其行业标准制定较粗，因此不同商家的WDM产品互通性极差，特别是在上层的网络管理方面。为了保证WDM系统在网络中大规模实施，需保证WDM系统间的互操作性以及WDM系统与传统系统间互连、互通，因此应加强光接口设备的研究。
WDM系统的网络管理，特别是具有复杂上/下通路需求的WDM网络管理不是很成熟。在网络中大规模采用需要对WDM系统进行有效网络管理。例如在故障管理方面，由于WDM系统可以在光通道上支持不同类型的业务信号，一旦WDM系统发生故障，操作系统应能及时自动发现，并找出故障原因；目前为止相关的运行维护软件仍不成熟；在性能管理方面，WDM系统使用模拟方式复用及放大光信号，因此常用的比特误码率并不适用于衡量WDM的业务质量，必须寻找一个新的参数来准确衡量网络向用户提供的服务质量等。
一些重要光器件的不成熟将直接限制光传输网的发展，如可调谐激光器等。通常光网络中需要采用4～6个能在整个网络中进行调谐的激光器，但目前这种可调谐激光器还很难商用化





码分复用

码分复用是用一组包含互相正交的码字的码组携带多路信号。采用同一波长的扩频序列，频谱资源利用率高，与WDM结合，可以大大增加系统容量。有码分多址，频分多址(FDMA)、时分多址(TDMA)和同步码分多址(SCDMA)等相关技术


码分复用(CDM，Code Division Multiplexing)是靠不同的编码来区分各路原始信号的一种复用方式，主要和各种多址技术结合产生了各种接入技术，包括无线和有线接入。例如在多址蜂窝系统中是
以信道来区分通信对象的，一个信道只容纳1个用户进行通话，许多同时通话的用户，互相以信道来区分，这就是多址。移动通信系统是一个多信道同时工作的系统，具有广播和大面积覆盖的特点。在移动通信环境的电波覆盖区内，建立用户之间的无线信道连接，是无线多址接入方式，属于多址接入技术

特点
码分多址系统为每个用户分配了各自特定的地址码，利用公共信道来传输信息。CDMA系统的地址码相互具有准正交性，以区别地址，而在频率、时间和空间上都可能重叠。也就是说，每一个用户有自己的地址码，这个地址码用于区别每一个用户，地址码彼此之间是互相独立的，也就是互相不影响的，但是由于技术等种种原因，我们采用的地址码不可能做到完全正交，即完全独立，相互不影响，所以称为准正交，由于有地址码区分用户，所以我们对频率、时间和空间没有限制，在这些方面他们可以重叠。

命令
利用多个掩码序列的其中一个对多个符号流的每一个进行编码，该已掩码的符号流被组合以形成码分复用(CDM)信号，并且利用另一个掩码序列该CDM信号被进一步地进行掩码，用于与一个和多个附加的信号进行码分复用，以发送到远程站。在另一个实施例中，根据经掩码的符号流形成了多个CDM信号，并且所述多个CDM信号在进一步进行掩码之前被时分复用(TDM)。在其它实施例中，解掩码和解复用被执行来恢复一个或多个符号流。也提出了其它不同的方面。这些方面具有的优点有：提供了对反向链路容量的有效利用，适应诸如低时延、高吞吐量或者不同服务质量这样的变化的需求，并且减小了提供这些优点的前向和反向链路开销，这样就避免了干扰过多和容量增加

码分多路复用
码分多路复用也是一种共享信道的方法，每个用户可在同一时间使用同样的频带进行通信，但使用的是基于码型的分割信道的方法，即每个用户分配一个地址码，各个码型互不重叠，通信各方之间不会相互干扰，且抗干拢能力强。
码分多路复用技术主要用于无线通信系统，特别是移动通信系统。它不仅可以提高通信的话音质量和数据传输的可靠性以及减少干扰对通信的影响，而且增大了通信系统的容量.笔记本电脑或个人数字助理(PersonalDataAssistant，PDA)以及掌上电脑(HandedPersonalCOmputer，HPC)等移动性计算机的联网通信就是使用了这种技术


FDMA
FDMA频分多址采用调频的多址技术，业务信道在不同的频段分配给不同的用户。FDMA适合大量连续非突发性数据的接入，单纯采用FDMA作为多址接入方式已经很少见

TDMA时分多址
TDMA时分多址采用了时分的多址技术，将业务信道在不同的时间段分配给不同的用户。TDMA的优点是频谱利用率高，适合支持多个突发性或低速率数据用户的接入。
CDMA码分多址
CDMA是采用数字技术的分支——扩频通信技术发展起来的一种崭新而成熟的无线通信技术，它是在FDM和TDM的基础上发展起来的。FDM的特点是信道独占，而时间资源共享，每一子信道使用的频带互不重叠；TDM的特点是独占时隙，而信道资源共享，每一个子信道使用的时隙不重叠；CDMA的特点是所有子信道在同一时间可以使用整个信道进行数据传输，它在信道与时间资源上均为共享，因此，信道的效率高，系统的容量大。CDMA的技术原理是基于扩频技术，即将需传送的具有一定信号带宽的信息数据用一个带宽远大于信号带宽的高速伪随机码(PN)进行调制，使原数据信号的带宽被扩展，再经载波调制并发送出去；接收端使用完全相同的伪随机码，与接收的带宽信号作相关处理，把宽带信号换成原信息数据的窄带信号即解扩，以实现信息通信。CDMA码分多址技术完全适合现代移动通信网所要求的大容量、高质量、综合业务、软切换等，正受到越来越多的运营商和用户的青睐。


同步码分多址技术
同步码分多址(SCDMA，Synchrnous Code Division Multiplexing Access)指伪随机码之间是同步正交的，既可以无线接入也可以有线接入，应用较广泛，它意味着代表所有用户的伪随机码在到达基站时是同步的，由于伪随机码之间的同步正交性，可以有效地消除码间干扰，系统容量方面将得到极大的改善，它的系统容量是其他第3代移动通信标准的4～5倍



应用
1、码分复用光接入网络系统
在光线路终端装置与光终端装置和光终端装置之间通过光纤传输路（和光合/分路器进行基于码分复用方式的双向通信。光线路终端装置具有频带控制部和频带分配部，频带控制部设有与光终端装置的数量相等个数的信号转换器对，光终端装置分别具有频带控制部和频带分配部，频带控制部中分别设有各1组信号转换器对。光线路终端装置和光终端装置的频带控制部分别具有由分别具有通信频带可变控制功能的1组可变串/并转换部和可变并/串转换部构成的信号转换部。能够进行与数据包长度无关的数据包的传输，即使在其他用户暂时需要大容量频带时也能够应对。
2、码分复用的早期应用之一是在全球定位系统（GPS）中。
3、高通标准IS-2000，被称为CDMA2000，用于全球星卫星电话网络。
4、UMTS 3G手机标准，使用W-CDMA。
5、CDMA已经在OmniTRACS卫星系统中用于运输物流


发展前沿
1、基于超连续谱和超结构光纤光栅的波分复用/光码分复用系统
实验验证了基于超连续谱(SC)和超结构光纤光栅(SSFBG)的波分复用/光码分复用(WDM/OCDM)混合系统,超结构光纤光栅实现了对超连续谱光源的双波段同时相位编解码。由于波分复用/光码分复用系统中信道间干涉和噪声的影响,解码输出脉冲的信号波形出现劣化,自相关曲线旁瓣明显增大,自相关峰展宽至8.2 ps。在非线性放大环镜(NALM)的阈值判决作用下,解码输出脉冲的信号波形质量有了明显的改善,自相关峰宽度压缩至4.8 ps,较好地抑制了自相关曲线的旁瓣和噪声。 [2] 
2、波分复用/光码分多址网络性能研究
基于波分复用/光码分复用混合网络模型,研究了光码分多址和波分复用/光码分复用网络性能,导出网络误码率公式;针对加性白色高斯噪声信道模型,将信息论应用到网络系统性能的分析上,得到网络的吞吐量公式。仿真结果表明:波分复用/光码分复用混合网络较单纯光码分多址网络具有容量大,网络扩展容易、方便等优点




数据链路层
三个基本问题
1. 封装成帧
将网络层传下来的分组添加首部和尾部，用于标记帧的开始和结束。

数据链路层是OSI参考模型中的第二层，介乎于物理层和网络层之间。数据链路层在物理层提供的服务的基础上向网络层提供服务，其最基本的服务是将源自网络层来的数据可靠地传输到相邻节点的目标机网络层

简介
数据链路层定义了在单个链路上如何传输数据。这些协议与被讨论的各种介质有关。示例：ATM，FDDI等。数据链路层必须具备一系列相应的功能，主要有：如何将数据组合成数据块，在数据链路层中称这种数据块为帧，帧是数据链路层的传送单位；如何控制帧在物理信道上的传输，包括如何处理传输差错，如何调节发送速率以使与接收方相匹配；以及在两个网络实体之间提供数据链路通路的建立、维持和释放的管理。
物理链路（物理线路）：是由传输介质与设备组成的。原始的物理传输线路是指没有采用高层差错控制的基本的物理传输介质与设备。
数据链路（逻辑线路）：在一条物理线路之上，通过一些规程或协议来控制这些数据的传输，以保证被传输数据的正确性。实现这些规程或协议的硬件和软件加到物理线路，这样就构成了数据链路，从数据发送点到数据接收点所经过的传输途径。当采用复用技术时，一条物理链路上可以有多条数据链路。


基本功能


数据链路层主要有两个功能 ：帧编码和误差纠正控制。帧编码意味着定义一个包含信息频率、位同步、源地址、目标地址以及其他控制信息的数据包。数据链路层协议又被分为两个子层 ：逻辑链路控制（LLC）协议和媒体访问控制（MAC）协议。 [1] 
数据链路层的最基本的功能是向该层用户提供透明的和可靠的数据传送基本服务。透明性是指该层上传输的数据的内容、格式及编码没有限制，也没有必要解释信息结构的意义；可靠的传输使用户免去对丢失信息、干扰信息及顺序不正确等的担心。在物理层中这些情况都可能发生，在数据链路层中必须用纠错码来检错与纠错。数据链路层是对物理层传输原始比特流的功能的加强，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一无差错的线路。

帧同步
为了使传输中发生差错后只将有错的有限数据进行重发，数据链路层将比特流组合成以帧为单位传送。每个帧除了要传送的数据外，还包括校验码，以使接收方能发现传输中的差错。帧的组织结构必须设计成使接收方能够 明确地从物理层收到的比特流中对其进行识别，也即能从比特流中区分出帧的起始与终止，这就是帧同步要解决的问题。
（1）字节计数法：这是一种以一个特殊字符表示一帧的起始并以一个专门字段来标明帧内字节数的帧同步方法。接收方可以通过对该特殊字符的识别从比特流中区分出帧的起始并从专门字段中获知该帧中随后跟随的数据字节数，从而可确定出帧的终止位置。面向字节计数的同步规程的典型代表是DEC公司的数字数据通信报文协议DDCMP（Digital Data Communications Message Protocol）。
控制字符SOH标志数据帧的起始。实际传输中，SOH前还要以两个或更多个同步字符来确定一帧的起始，有时也允许本帧的头紧接着上帧的尾，此时两帧间就不必再加同步字符。count字段共有14位，用以指示帧中数据段中数据的字节数，14位二进制数的最大值为16383，所以数据最大长度为131064。DDCMP协议就是靠这个字节计数来确定帧的终止位置的。DDCMP帧格式中的ACK、SEG、ADDR及FLAG中的第2位CRC1、CRC2分别对标题部分和数据部分进行双重校验，强调标题部分单独校验的原因是，一旦标题部分中的CONUT字段出错，即失却了帧边界划分的依据。由于采用字符计数方法来确定帧的终止边界不会引起数据及其它信息的混淆，因而不必采用任何措施便可实现数据的透明性（即任何数据均可不受限制地传输）。
（2）使用字符填充的首尾定界符法：该法用一些特定的字符来定界一帧的起始与终止，为了不使数据信息位中出现的与特定字符相同的字符被误判为帧的首尾定界符，可以在这种数据字符前填充一个转义控制字符（DLE）以示区别，从而达到数据的透明性。但这种方法使用起来比较麻烦，而且所用的特定字符过份依赖于所采用的字符编码集，兼容性比较差。
（3）使用比特填充的首尾标志法：该法以一组特定的比特模式来标志一帧的起始与终止。
（4）违法编码法：该法在物理层采用特定的比特编码方法时采用。例如，一种被称作曼彻斯特编码的方法，是将数据比特“1”编码成“高－低”电平对，而将数据比特“0”编码成“低－高”电平对。而“高－高”电平对和“低－低”电平对在数据比特中是违法的。可以借用这些违法编码序列来定界帧的起始与终止。局域网IEEE 802标准中就采用了这种方法。违法编码法不需要任何填充技术，便能实现数据的透明性，但它只适用于采用冗余编码的特殊编码环境。由于字节计数法中COUNT字段的脆弱性以及字符填充法实现上的复杂性和不兼容性，较普遍使用的帧同步法是比特填充和违法编码法

差错控制
一个实用的通信系统必须具备发现（即检测）这种差错的能力，并采取某种措施纠正之，使差错被控制在所能允许的尽可能小的范围内，这就是差错控制过程，也是数据链路层的主要功能之一。对差错编码（如奇偶校验码，检查和或CRC）的检查，可以判定一帧在传输过程中是否发生了错误。一旦发现错误，一般可以采用反馈重发的方法来纠正。这就要求接收方收完一帧后，向发送方反馈一个接收是否正确的信息，使发送方所在此作出是不需要重新发送的决定，也即发送方仅当收到接收方已正确接收的反馈信号后才能认为该帧已经正确发送完毕，否则需要重新发送直至正确为止。物理信道的突发噪声可能完全“淹没”一帧，即使得整个数据帧或反馈信息帧丢失，这将导致发送方永远收不到接收方发来的反馈信息，从而使传输过程停滞.为了避免出现这种情况，通常引入计时器(Timer)来限定接收方发回反馈信息的时间间隔，当发送方发送一帧的同时也启动计时器，若在限定时间间隔内未能收到接收方的反馈信息，即计时器超时(Timeout)，则可认为传的帧已出错或丢失，继而要重新发送。由于同一帧数据可能被重复发送多次。为了防止发生这种危险，可以采用对发送的帧编号的方法，即赋予每帧一个信号，从而使接收方能从该序号来区分是新发送来的帧还是已经接收但又重新发送来的帧，以此来确定要不要将接收到的帧递交给网络层。数据链路层通过使用计数器和序号来保证每帧最终都被正确地递交给目标网络层一次。



流量控制
流量控制并不是数据链路层所特有的功能，许多高层协议中也提供流时控功能，只不过流量控制的对象不同而已。比如，对于数据链路层来说，控制的是相邻两节点之间数据链路上的流量，而对于传输层来说，控制的则是从源到最终目的之间端的流量。由于收发双方各自使用的设备工作速率和缓冲存储的空间的差异，可能出现发送方发送能力大于接收方接收能力的现象，如若此时不对发送方的发送速率（也即链路上的信息流量）作适当的限制，前面来不及接收的帧将被后面不断发送来的帧“淹没”，从而造成帧的丢失而出错。由此可见，流量控制实际上是对发送方数据流量的控制，使其发送率不致超过接收方所能承受的能力。这个过程需要通过某种反馈机制使发送方知道接收方是否能跟上发送方，也即需要有一些规则使得发送方知道在什么情况下可以接着发送下一帧，而在什么情况下必须暂停发送，以等待收到某种反馈信息后继续发送。


链路管理


链路管理功能主要用于面向连接的服务。当链路两端的节点要进行通信前，必须首先确认对方已处于就绪状态，并交换一些必要的信息以对帧序号初始化，然后才能建立连接，在传输过程中则要能维持该连接。如果出现差错，需要重新初始化，重新自动建立连接。传输完毕后则要释放连接。数据连路层连接的建立维持和释放就称作链路管理。在多个站点共享同一物理信道的情况下（例如在LAN中）如何在要求通信的站点间分配和管理信道也属于数据链路层管理的范畴。

相关协议

数据链路控制协议也称链路通信规程，也就是OSI参考模型中的数据链路层协议。链路控制协议可分为异步协议和同步协议两大类。
数据链路层的主要协议有：
(1)点对点协议（Point-to-Point Protocol);
(2)以太网（Ethernet);
(3)高级数据链路协议(High-Level Data Link Protocol);
(4) 帧中继（Frame Relay);
(5) 异步传输模式(Asynchronous Transfer Mode);
异步协议
以字符为独立的信息传输单位，在每个字符的起始处开始对字符内的比特实现同步，但字符与字符之间的间隔时间是不固定的（即字符之间是异步的）。由于发送器和接收器中近似于同 一频率的两个约定时钟，能够在一段较短的时间内保持同步，所以可以用字符起始处同步的时钟来采样该字符中的各比特，而不需要每个比特再用其它方法同步。异步协议中因为每个传输字符都要添加诸如起始位、校验位及停止位等冗余位，故信道利用率很低，一般用于数据速率较低的场合。

同步协议
同步协议是以许多字符或许多比特组织成的数据块——帧为传输单位，在帧的起始处同步，使帧内维持固定的时钟。实际上该固定时钟是发送端通过某种技术将其混合在数据中一并发送出去的，供接收端从输入数据中分离出时钟来，实现起来比较复杂，这个功能通常是由解调器来完成。由于采用帧为传输单位，所以同步协议能更有效地利用信道，也便于实现差错控制、流量控制等功能。同步协议又可分为面向字符的同步协议、面向比特的同步协议及面向字节计数的同步协议三种类型


HDLC
HDLC是通用的数据链路控制协议，当开始建立数据链路时，允许选用特定的操作方式。所谓链路操作方式，通俗地讲就是某站点以主站方式操作，还是以从站方式操作，或者是二者兼备。在链路上用于控制目的站称为主站，其它的受主站控制的站称为从站。主站负责对数据流进行组织，半且对链路上的差错实施恢复。由主站发往从站的帧称为命令帧，而由由站返回主站的帧称响应帧。连有多个站点的链路通常使用轮询技术，轮询其它站的站称为主站，而在点到点燃链路中每个站均可为主站。主站需要比从站有更多的逻辑功能，所以当终端与主机相连时，主机一般总是主站。

操作方式
HDLC中常用的操作方式有以下三种：
(1)正常响应方式NRM是一种非平衡数据链路操作方式，有时也称非平衡正常响应方式。该操作方式适用于面向终端的点到点或一点与多点的链路。在这种操作方式，传输过程由主站启动，从站只有收到主站某个命令帧后，才能作为响应向主站传输信息。响应信息可以由一个或多个帧组成，若信息 由多个帧组成，则应指出哪一个是最后一帧。主站负责管理整个链路，且具有轮询、选择从站及向从站发送命令的权利，同时也负责对超时、重发及各类恢复操作的控制。
（2）异步响应方式ARM，异步响应方式ARM也是一种非平衡数据链路操作方式，与NRM不同的是，ARM的传输过程由从站启动。从站主动发送给主站的一个或一组帧中可包含有信息，也可以是仅以控制为目的而发的帧。在这种操作方式下，由从站来控制超时和重发。该方式对采用轮询方式的多站莲路来说是必不可少的。ARM操作方式见图3.7(b)。
（3）异步平衡方式ABM，异步平衡方式ABM是一种允许任何节点来启动传输的操作方式。为了提高链路传输效率，节点之间在两个方向上都需要的较高的信息传输量。在这种操作方式下任何时候任何站都能启动传输操作，每个站既可作为主站又可作为从站，每个站都是组合站。各站都有相同的一组协议，任何站都可以发送或接收命令，也可以给出应答，并且各站对差错恢复过程都负有相同的责任。
帧格式
在HDLC中，数据和控制报文均以帧的标准格式传送。HDLC中的帧类似于BSC的字符块，但BSC协议中的数据报文和控制报文是独立传输的，而HDLC中的命令应以统一的格式按帧传输。HDLC的完整的帧由标志字段（F）、地址字段（A）、控制字段（C）、信息字段（I）、帧校验序列字段（FCS）等组成。

（1）标志字段（F）：标志字段为01111110的比特模式，用以标志帧的起始和前一帧的终止。标志字段也可以作为帧与帧之间的填充字符。通常，在不进行帧传送的时刻，信道仍处于激活状态，在这种状态下，发方不断地发送标志字段，便可认为一个新的帧传送已经开始。采用“0比特插入法”可以实现0数据的透明传输。
（2）地址字段（A）：地址字段的内容取决于所采用的操作方式。在操作方式中，有主站、从站、组合站之分。每一个从站和组合站都被分配一个唯一的地址。命令帧中的地址字段携带的是对方站的地址，而响应帧中的地址字段所携带的地址是本站的地址。某一地址也可分配给不止一个站，这种地址称为组地址，利用一个组地址传输的帧能被组内所有拥有该组一焉的站接收。但当一个站或组合站发送响应时，它仍应当用它唯一的地址。还可用全“1”地址来表示包含所有站的地址，称为广播地址，含有广播地址的帧传送给链路上所有的站。另外，还规定全“0”地址为无站地址，这种地址不分配给任何站，仅作作测试。
（3）控制字段（C）：控制字段用于构成各种命令和响应，以便对链路进行监视和控制。发送方主站或组合站利用控制字段来通知被寻址的从站或组合站执行约定的操作；相反，从站用该字段作对命令的响应，报告已完成的操作或状态的变化。该字段是HDLC的关键。控制字段中的第一位或第一、第二位表示传送帧的类型，HDLC中有信息帧（I帧）、监控帧（S帧）和无编号帧（U帧）三种不同类型的帧。控制字段的第五位是P/F位，即轮询/终止（Poll/Final）位。
（4）信息字段（I）：信息字段可以是任意的二进制比特串。比特串长度未作限定，其上限由FCS字段或通信站的缓冲器容量来决定，国际上用得较多的是1000~2000比特；而下限可以为0，即无信息字段。但是，监控帧（S帧）中规定不可有信息字段。
（5）帧校验序列字段（FCS）：帧校验序列字段可以使用16位CRC，对两个标志字段之间的整个帧的内容进行校验。 [2] 
帧类型
HDLC有信息帧（I帧）、监控帧（S帧）和无编号帧（U帧）三种不同类型的帧。
（1）信息帧（I帧）：信息帧用于传送有效信息或数据，通常简称I帧。I帧以控制字第一位为“0”来标志。信息帧的控制字段中的N（S）用于存放发送帧序号，以使发送方不必等待确认而连续发送多帧。N（R）用于存放接收方下一个预期要接收的帧的序号，N（R）=5，即表示接收方下一帧要接收5号帧，换言之，5号帧前的各帧接收到。
（2）监控帧（S帧）：监控帧用于差错控制和流量控制，通常简称S帧。S帧以控制字段第一、二位为“10”来标志。S帧带信息字段，只有6个字节即48个比特。S帧的控制字段的第三、四位为S帧类型编码，共有四种不同编码，分别表示：
00——接收就绪（RR），由主站或从站发送。主站可以使用RR型S帧来轮询从站，从站传输编号为N（R）的I帧，若存在这样的帧，便进行传输；从站也可用RR型S帧来作响应，表示从站希望从主站那里接收的下一个I帧的编号是N（R）。
01——拒绝（REJ），由主站或从站发送，用以要求发送方对从编号为N（R）开始的帧及其以后所有的帧进行重发，这也暗示N（R）以前的I帧已被正确接收。
10——接收未就绪（RNR），表示编号小于N（R）的I帧已被收到，但正处于忙状态，尚未准备好接收编号为N（R）的I帧，这可用来对链路流量进行控制。
11——选择拒绝（SREJ），它要求发送方发送编号为N（R）单个I帧，并暗示它编号的I帧已全部确认
（3）无编号帧（U帧）：无编号帧因其控制字段中不包含编号N（S）和N（R）而得名，简称U帧。U帧用于提供对链路的建立、拆除以及多种控制功能，这些控制功能5个M位（M1、M2、M3、M4、M5，也称修正位）来定义。5个M位可以定义32种附加的命令功能或32种应答功能，但许多是空缺的。


逻辑链路控制层

在逻辑链路控制子层，我们通过执行一个停止或等待自动重复检索（ARQ）协议来检测误差和请求重传错误帧。源节点A在发送下一帧数据之前等待一个来自目标节点B的回执（ACK）。如果在预置暂停时间内没接收到回执，A重传这帧数据。在数据帧来回传播的时间段内，信道保持空闲。在全双工通信链路，如果节点 A 在等待 ACK 时连续传送相同的数据帧，网络吞吐量可以增大。

DLSL层子系统依功能可划分为：DLSL初始化模块、DLSL状态机模块、DLSL数据服务模块、DLSL管理服务模块、DLSL处理MAC 层消息模块、通信调度模块、信道跳频模块和安全模块。

媒介访问控制子层

数据链路层最关键的技术就是媒体访问控制（MAC）。它的作用是平均分配存在竞争和高吞 吐量节点之间的信道资源。带冲突避免的多址接入（MACA）协议利用两个叫做请求 / 发送（RTS） 和清除 / 发送（CTS）的信号帧来检测冲突。它是 MAC 子层的常用协议。当源节点A想要发送信息到目标节点B时，它会首先发出一个 RTS命令。如果节点B收到RTS，它则会发送回一个CTS命令。如果节点A没有在预定时间内接收到CTS，它将重新发送 RTS。只要节点 A 一收到CTS，它就立刻开 始传输数据帧。任何监听到CTS的其他节点将会延迟一个数据包长度的时间来避免冲突。
MACAW协议是MACA协议的改良版 ，它提高了UAN 的性能和可靠性。 
MAC层子系统依功能可划分为：MAC层初始化模块、MAC层状态机模块、MAC层数据服务功能模块、MAC 层管理服务功能模块、MAC层处理RF消息模块、时隙处理模块和时间同步模块


 透明传输
透明表示一个实际存在的事物看起来好像不存在一样。

帧中有首部和尾部，如果帧的数据部分含有和首部尾部相同的内容，那么帧的开始和结束位置就会被错误的判定。需要在数据中出现首部尾部相同的内容前面插入转义字符，如果需要传输的内容正好就是转义字符，那么就在转义字符前面再加个转义字符，在接收端进行处理之后可以还原出原始数据。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。


透明传输是指不管所传数据是什么样的比特组合，都应当能够在链路上传送。当所传数据中的比特组合恰巧与某一个控制信息完全一样时，就必须采取适当的措施，使接收方不会将这样的数据误认为是某种控制信息。这样才能保证数据链路层的传输是透明的。

特点
发送方和接收方数据的长度和内容完全一致，相当于一条无形的传输线。透明传输技术在诸如OTN、PTN的很多领域都有使用。T-MPLS网络中，PWE3是其中的一项关键技术。PWE3(Pseudo Wire Emulation Edge-to-Edge)是一种业务仿真机制，希望提供尽量少的功能，按照给定业务的要求仿真线路。这一机制要求在分组交换网络（PSN）的隧道中建立与维护伪线（PW），使用PW封装和传送业务数据或时钟同步信息，并尽可能真实地保持业务数据或时钟同步信息本身具有的属性和特征。对于客户设备而言，PW表现为特定业务独占的一条链路或电路，称之为虚电路（VC-Virtual Circuit）。下图为网络模型示意图。
对于提供多业务传送的服务提供商，当前的基础设施通常由并行或重叠的网络构成，这些网络的每一部分执行特定的服务，这给网络建设与维护两个方面都带来沉重的负担。呈现的多网络也使得网络规划趋于复杂。为获取最大的投资回报和付出最小的维护代价，服务提供商指望将多业务纳入到单一的网络之中，这就是经优化的分组汇聚网络。
这种数据传输的方式叫做透明传输

问题
透明传输就是在传输过程中，对外界透明，就是说你看不见他是传送网络，不管传输的业务如何，我只负责将需要传送的业务传送到目的节点，同时保证传输的质量即可，而不对传输的业务进行处理。
透明传输是指数据直接通过系统中的互连功能模式而不进行RLP纠错，如果进行了RLP纠错即为非透明传输。
就是所谓的透明传输，不管传的是什么，所采用的设备只是起一个通道作用，把要传输的内容完好的传到对方！
透传的设备是个黑箱子，进来是什么出去也是什么。
透明传输不用关心下层协议的传输，比如你要寄信，只需要写地址交给邮局就行了，然后对方就能收到你的信，但是中途经过多少车站，火车，邮递员，你根本不知道，所以对于你来说邮递的过程是透明的

特点

与面向连接和电话系统的工作模式相似，其特点是：
1、面向连接的数据传输过程必须经过建立连接、连接维护和释放连接的3个过程；
2、数据传输过程中，各分组不需要携带目的地址。
面向连接数据传输的收发数据顺序不变，因此传输的可靠性好，但协议复杂，通信效率不高。
说明：RLP(Radio Link Protocol): 无线连接协议，是一种严格的纠错方式。当数据在接收端被 “查出”有错后，接收端可要求电话重新进行数据传输，如有必要，反复进行，直至接收数据完全正确为止。






























